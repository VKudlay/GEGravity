<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GE_Gravity Example • GEGravity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="GE_Gravity Example">
<meta property="og:description" content="GEGravity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GEGravity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/about.html">GE_Gravity Theory, Logic, Testing, and Comparison</a>
    </li>
    <li>
      <a href="../articles/compare.html">GE_Gravity Logic and Testing</a>
    </li>
    <li>
      <a href="../articles/example.html">GE_Gravity Example</a>
    </li>
    <li>
      <a href="../articles/logic.html">GE_Gravity Logic</a>
    </li>
    <li>
      <a href="../articles/theory.html">GE_Gravity Theory</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/VKudlay/GEGravity/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>GE_Gravity Example</h1>
                        <h4 data-toc-skip class="author">Tom Zylkin,
Vadim Kudlay</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/VKudlay/GEGravity/blob/HEAD/vignettes/example.Rmd" class="external-link"><code>vignettes/example.Rmd</code></a></small>
      <div class="hidden name"><code>example.Rmd</code></div>

    </div>

    
    
<p>This example RMD uses the example data <code>TradeData0014</code>,
which is included with this package. The data set consists of a panel of
44 countries trading with one another over the years 2000-2014. The
trade data uses aggregated trade flows based on <a href="http://www.wiod.org/database/wiots16" class="external-link">WIOD</a> and information on
FTAs is from the <a href="https://sites.nd.edu/jeffrey-bergstrand/database-on-economic-integration-agreements/" class="external-link">NSF-Kellogg
database</a> maintained by Scott Baier and Jeff Bergstrand. To find out
more about the trade data, see <a href="https://www.researchgate.net/publication/274731196_An_Illustrated_User_Guide_to_the_World_Input-Output_Database_The_Case_of_Global_Automotive_Production" class="external-link">“Timmer,
Dietzenbacher, Los, Stehrer, and de Vries (2015)</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">TradeData0014</span><span class="op">)</span> <span class="co"># loads data included with package</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">TradeData0014</span><span class="op">)</span></span>
<span><span class="co">#&gt;   exporter importer expcode impcode year        trade eu_enlargement other_fta</span></span>
<span><span class="co">#&gt; 1      AUS      AUS       1       1 2000 7.047775e+05              0         1</span></span>
<span><span class="co">#&gt; 2      AUS      AUS       1       1 2005 1.334877e+06              0         1</span></span>
<span><span class="co">#&gt; 3      AUS      AUS       1       1 2010 2.210350e+06              0         1</span></span>
<span><span class="co">#&gt; 4      AUS      AUS       1       1 2014 2.436575e+06              0         1</span></span>
<span><span class="co">#&gt; 5      AUS      AUT       1       2 2000 6.195446e+01              0         0</span></span>
<span><span class="co">#&gt; 6      AUS      AUT       1       2 2005 1.407591e+02              0         0</span></span>
<span><span class="co">#&gt;   FTA</span></span>
<span><span class="co">#&gt; 1   1</span></span>
<span><span class="co">#&gt; 2   1</span></span>
<span><span class="co">#&gt; 3   1</span></span>
<span><span class="co">#&gt; 4   1</span></span>
<span><span class="co">#&gt; 5   0</span></span>
<span><span class="co">#&gt; 6   0</span></span></code></pre></div>
<p>Suppose the researcher wishes to use this data set to quantify
general equilibrium trade and welfare effects of the EU enlargements
that took place between 2000-2014. To first obtain the partial effects
of these enlargements on trade flows, a PPML (Poisson pseudo-maximum
likelihood) gravity specification may be used. Specifically, to obtain
the “partial” estimates of the effects of EU enlargements on trade, we
can use the following three-way gravity specification:</p>
<p><span class="math display">\[X_{ijt} = \exp\bigg[\ln(\alpha_{it}) +
\ln(\alpha_{jt}) + \ln(\alpha_{ij}) + \beta \cdot FTA_{ijt}\bigg] +
e_{ijt}\]</span></p>
<p>The Stata equivalent of this package uses the ppmlhdfe command
created by Correia, Guimarães, &amp; Zylkin (2019) to achieve this. In
our example, we will use the <a href="https://CRAN.R-project.org/package=alpaca" class="external-link">‘alpaca’ library</a> by
Amrei Stammann to do the same via the (Fixed-Effect Generalized Linear
Model) function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amrei-stammann/alpaca" class="external-link">alpaca</a></span><span class="op">)</span>  <span class="co"># Needed for partial coefficients</span></span>
<span></span>
<span><span class="co"># Generate foreign trade subset</span></span>
<span><span class="va">f_trade</span> <span class="op">&lt;-</span> <span class="va">TradeData0014</span><span class="op">[</span><span class="va">TradeData0014</span><span class="op">$</span><span class="va">exporter</span> <span class="op">!=</span> <span class="va">TradeData0014</span><span class="op">$</span><span class="va">importer</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># classify FEs for components to be absorbed (finding variable interactions)</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">exp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">imp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">pair</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit gravity model using PPML with exporter-time, importer-time, and exporter-importer FEs</span></span>
<span><span class="va">partials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/alpaca/man/feglm.html" class="external-link">feglm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">trade</span> <span class="op">~</span> <span class="va">eu_enlargement</span> <span class="op">+</span> <span class="va">other_fta</span> <span class="op">|</span> <span class="va">exp_year</span> <span class="op">+</span> <span class="va">imp_year</span> <span class="op">+</span> <span class="va">pair</span>,</span>
<span>  data    <span class="op">=</span> <span class="va">f_trade</span>,</span>
<span>  family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">coefficient</span>  <span class="co"># We just need the coefficients for computation</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">partials</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;          0.224         -0.037</span></span></code></pre></div>
<p>In addition to estimating the effects of EU enlargements on new EU
pairs, this example also controls for any other FTAs signed during the
period. Each of these variables is coded as a dummy variable that
becomes 1 when the agreement goes into effect for a given pair. The
estimated coefficient for is 0.224, implying that the expansion of the
EU had an average partial effect of <span class="math inline">\(e^{0.224} − 1 = 25.1\%\)</span> on trade between
new EU members and existing members. With clustered standard errors,
this estimate is statistically significant at the <span class="math inline">\(p &lt; .01\)</span> significance level.</p>
<hr>
<p>Before proceeding, some further pre-processing is needed.
Specifically, we need to supply the function with the partial effects of
joining the EU estimated above for each of the appropriate pairs. To do
this, we create a new variable whose value is either the eu_enlargement
partial computed above or 0. We will use the year 2000 as the baseline
for the general equilibrium counterfactual, so we assign these partial
effects in the year 2000.</p>
<p>For Stata users, the Stata equivalent of this next step is:</p>
<pre><code>sort exporter importer year
by exporter importer: gen new_eu_pair = (eu_enlargement[_N]-eu_enlargement[1])                   
by exporter importer: gen eu_effect = _b[eu_enlargement] * new_eu_pair</code></pre>
<p>In R, we do the following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sort matrix to make it easier to find imp/exp pairs</span></span>
<span><span class="va">t_trade</span> <span class="op">&lt;-</span> <span class="va">TradeData0014</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span></span>
<span>  <span class="va">TradeData0014</span><span class="op">$</span><span class="va">exporter</span>,</span>
<span>  <span class="va">TradeData0014</span><span class="op">$</span><span class="va">importer</span>,</span>
<span>  <span class="va">TradeData0014</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>,</span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">t_trade</span><span class="op">$</span><span class="va">new_eu_pair</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">t_trade</span><span class="op">$</span><span class="va">eu_effect</span>   <span class="op">&lt;-</span> <span class="cn">NA</span>   <span class="co"># this creates a new column that will contain partial effect of EU membership for new EU pairs</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Effect of EU entrance on country based on partial, if entry happened</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">t_trade</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">t_trade</span><span class="op">$</span><span class="va">expcode</span>, <span class="va">t_trade</span><span class="op">$</span><span class="va">impcode</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Was a new EU pair created within time span?</span></span>
<span>  <span class="va">t_trade</span><span class="op">[</span><span class="va">i</span><span class="op">:</span><span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="st">"new_eu_pair"</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">row</span><span class="op">$</span><span class="va">eu_enlargement</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If added to EU, give it the computed partial eu_enlargement coefficient (0.224) as the effect</span></span>
<span><span class="va">t_trade</span><span class="op">$</span><span class="va">eu_effect</span> <span class="op">=</span> <span class="va">t_trade</span><span class="op">$</span><span class="va">new_eu_pair</span> <span class="op">*</span> <span class="va">partials</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>To finalize the data for the counterfactual, we will use the year
2000 as the baseline year. The data we will feed to the ‘ge_gravity’
command looks like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Data to be finally fed to the function (we base the counterfactual on the year 2000.)</span></span>
<span><span class="va">ge_baseline_data</span> <span class="op">&lt;-</span> <span class="va">t_trade</span><span class="op">[</span><span class="va">t_trade</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2000</span>,<span class="op">]</span>   <span class="co"># In example, 1892 Entries, 5676 removed</span></span>
<span></span>
<span><span class="co"># head(data) # First 10 rows</span></span>
<span><span class="va">ge_baseline_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ge_baseline_data</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,<span class="op">]</span>  <span class="co"># 10 random rows</span></span>
<span><span class="co">#&gt;      exporter importer expcode impcode year        trade eu_enlargement</span></span>
<span><span class="co">#&gt; 6749      SVK      FRA      39      16 2000 3.525703e+02              0</span></span>
<span><span class="co">#&gt; 2361      EST      HRV      14      19 2000 4.696484e-01              0</span></span>
<span><span class="co">#&gt; 4373      JPN      RUS      25      38 2000 7.188399e+02              0</span></span>
<span><span class="co">#&gt; 2877      GBR      FRA      17      16 2000 3.085328e+04              1</span></span>
<span><span class="co">#&gt; 2801      FRA      SWE      16      41 2000 5.576677e+03              1</span></span>
<span><span class="co">#&gt; 4781      LUX      CHN      28       8 2000 1.050690e+02              0</span></span>
<span><span class="co">#&gt; 7553      TWN      SWE      43      41 2000 6.227414e+02              0</span></span>
<span><span class="co">#&gt; 2205      ESP      ITA      13      24 2000 1.172864e+04              1</span></span>
<span><span class="co">#&gt; 7165      SWE      NLD      41      32 2000 3.927551e+03              1</span></span>
<span><span class="co">#&gt; 5913      POL      LTU      34      27 2000 3.654052e+02              0</span></span>
<span><span class="co">#&gt;      other_fta FTA new_eu_pair eu_effect</span></span>
<span><span class="co">#&gt; 6749         1   1           1  0.224249</span></span>
<span><span class="co">#&gt; 2361         0   0           1  0.224249</span></span>
<span><span class="co">#&gt; 4373         0   0           0  0.000000</span></span>
<span><span class="co">#&gt; 2877         0   1           0  0.000000</span></span>
<span><span class="co">#&gt; 2801         0   1           0  0.000000</span></span>
<span><span class="co">#&gt; 4781         0   0           0  0.000000</span></span>
<span><span class="co">#&gt; 7553         0   0           0  0.000000</span></span>
<span><span class="co">#&gt; 2205         0   1           0  0.000000</span></span>
<span><span class="co">#&gt; 7165         0   1           0  0.000000</span></span>
<span><span class="co">#&gt; 5913         1   1           1  0.224249</span></span></code></pre></div>
<p>Now that we have the data we need, we can run the ‘ge_gravity’
function as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ge_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ge_gravity.html">ge_gravity</a></span><span class="op">(</span></span>
<span>  exp_id <span class="op">=</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">expcode</span>,    <span class="co"># Origin country associated with each observation</span></span>
<span>  imp_id <span class="op">=</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">impcode</span>,    <span class="co"># Destination country associated with each observation</span></span>
<span>  flows  <span class="op">=</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">trade</span>,      <span class="co"># Observed trade flows in the data for the year being used as the baseline</span></span>
<span>  beta   <span class="op">=</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">eu_effect</span>,  <span class="co"># “Partial” change in trade, obtained as coefficient from gravity estimation</span></span>
<span>  theta  <span class="op">=</span> <span class="fl">4</span>,               <span class="co"># Trade elasticity</span></span>
<span>  mult   <span class="op">=</span> <span class="cn">FALSE</span>,           <span class="co"># Assume trade balance is an additive component of national expenditure</span></span>
<span>  data   <span class="op">=</span> <span class="va">ge_baseline_data</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ge_results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ge_results</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">12</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">]</span> <span class="co"># 10 random rows</span></span>
<span><span class="co">#&gt;      exporter importer year      trade  new_trade   welfare real_wage  nom_wage</span></span>
<span><span class="co">#&gt; 1913      DEU      SVK 2000 2723.95149 3269.19970 1.0007249 1.0007204 1.0002367</span></span>
<span><span class="co">#&gt; 3685      IDN      TUR 2000  206.00501  205.85536 0.9999865 0.9999931 0.9998933</span></span>
<span><span class="co">#&gt; 2501      FIN      CZE 2000  217.43389  264.63294 1.0004615 1.0004125 1.0008138</span></span>
<span><span class="co">#&gt; 4709      LTU      POL 2000  169.35396  207.88813 1.0065244 1.0064727 0.9993151</span></span>
<span><span class="co">#&gt; 3053      GRC      FRA 2000  271.52443  271.85529 1.0002792 1.0002622 0.9998333</span></span>
<span><span class="co">#&gt; 949       CAN      GRC 2000  207.26002  206.92770 0.9999912 0.9999941 0.9999349</span></span>
<span><span class="co">#&gt; 4301      JPN      HUN 2000  890.71506  862.04180 0.9999971 0.9999982 0.9999063</span></span>
<span><span class="co">#&gt; 2973      GBR      SVN 2000  283.02320  333.17404 1.0001393 1.0001392 1.0001324</span></span>
<span><span class="co">#&gt; 5749      NOR      MEX 2000   96.39469   96.31901 1.0002589 1.0002422 1.0001253</span></span>
<span><span class="co">#&gt; 6025      PRT      DEU 2000 3186.03737 3182.00629 1.0000813 1.0000725 0.9998933</span></span>
<span><span class="co">#&gt;      price_index</span></span>
<span><span class="co">#&gt; 1913   0.9995167</span></span>
<span><span class="co">#&gt; 3685   0.9999002</span></span>
<span><span class="co">#&gt; 2501   1.0004012</span></span>
<span><span class="co">#&gt; 4709   0.9928884</span></span>
<span><span class="co">#&gt; 3053   0.9995712</span></span>
<span><span class="co">#&gt; 949    0.9999408</span></span>
<span><span class="co">#&gt; 4301   0.9999082</span></span>
<span><span class="co">#&gt; 2973   0.9999932</span></span>
<span><span class="co">#&gt; 5749   0.9998831</span></span>
<span><span class="co">#&gt; 6025   0.9998208</span></span></code></pre></div>
<p>This assumes a standard trade elasticity value of <span class="math inline">\(\theta = 4\)</span>. The input for <span class="math inline">\(\beta\)</span> is given by the variable we created
called <code>eu_effect</code>, which is equal to 0.224 for new EU pairs
formed during the period and equal to 0 otherwise. Because of the small
size of the sample, it solves almost instantly. Sample results for the
first 10 rows in the data are shown above for the counterfactual trade
level and the associated changes in welfare, real wages, nomimal wages,
and the local price index. Click on the right arrow to scroll to the
right if they are not all displayed above. For the latter four
variables, the number shown is the result computed for the
<em>exporting</em> country. Unsurprisingly, the new EU members
(Bulgaria, Croatia, Czech Republic, Estonia, Hungary, Latvia, Lithuania,
Malta, Poland, Romania, Slovakia, and Slovenia) realize the largest
welfare gains from their joining the EU, with existing EU countries also
gaining. All countries not included in the agreement experience small
losses due to trade diversion, with the largest losses accruing to
Russia.</p>
<p>We can also change how trade imbalances enter the model. The default
(exibited above with mult = FALSE) is to assume that they enter
expenditure additively (i.e., <span class="math inline">\(E_j = Y_j +
D_j\)</span>), but one can also change the model so that expenditure is
instead a fixed multiple of income (i.e., let <span class="math inline">\(E_j = \delta_j Y_j\)</span>.) by setting
<code>mult = TRUE</code>. While using multiplicative imbalances instead
of additive balances changes the results slightly, they are still
qualitatively very similar.</p>
<p>An important point about the above exercises is that the initial
partial effect is estimated with some uncertainty. The GE results that
were calculated may paint a misleading picture because they do not take
this uncertainty into account. For this reason, it is considered good
practice to use a bootstrap method to construct confidence intervals for
the GE calculations. This type of procedure can be made easier using
<code>ge_gravity</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>  <span class="co"># needed below for bootstrap procedure</span></span>
<span></span>
<span><span class="co"># Helper function for shuffling the data with replacement.</span></span>
<span><span class="co"># This allows us to shuffle by pair rather than treating each observation as independent.</span></span>
<span><span class="va">get_bootdata</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,<span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">uniq_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="va">id</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">draw</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">uniq_id</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">draw</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">draw</span><span class="op">)</span><span class="op">[</span>,<span class="va">.N</span>,by<span class="op">=</span><span class="va">draw</span><span class="op">]</span>  <span class="co"># count duplicate pairs in bootstrap sample</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">draw</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">id</span></span>
<span>  <span class="va">boot_data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">draw</span>,<span class="st">"pair"</span>,all.x<span class="op">=</span><span class="cn">FALSE</span>,all.y<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">boot_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">boot_data</span><span class="op">)</span>, <span class="va">boot_data</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>  <span class="co"># replicates pairs drawn multiple times after merge</span></span>
<span>  <span class="va">boot_data</span>  <span class="op">&lt;-</span> <span class="va">boot_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">boot_index</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">boot_data</span><span class="op">$</span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">boot_data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">boot_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># set up for pair bootstrap</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span>
<span><span class="va">bootreps</span>      <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">TradeData0014</span><span class="op">[</span>,<span class="st">"pair"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">TradeData0014</span><span class="op">$</span><span class="va">expcode</span>,<span class="va">TradeData0014</span><span class="op">$</span><span class="va">impcode</span><span class="op">)</span> <span class="co"># This is the ID we will use for resampling.</span></span>
<span></span>
<span><span class="co"># Initialize matrices for saving results</span></span>
<span><span class="va">x</span>             <span class="op">&lt;-</span> <span class="va">TradeData0014</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eu_enlargement"</span>,<span class="st">"other_fta"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">save_partials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">bootreps</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bootreps</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">GE_effects</span>    <span class="op">&lt;-</span> <span class="va">ge_results</span><span class="op">[</span>,<span class="fl">11</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span></span>
<span><span class="va">save_GE</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">bootreps</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">GE_effects</span><span class="op">)</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bootreps</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">GE_effects</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate bootstrapped gravity estimates using alpaca's feglm function (20 boot reps)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amrei-stammann/alpaca" class="external-link">alpaca</a></span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">bootreps</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># This step shuffles the data using the get_bootdata() function defined above</span></span>
<span>    <span class="va">boot_data</span> <span class="op">&lt;-</span> <span class="fu">get_bootdata</span><span class="op">(</span><span class="va">TradeData0014</span>,<span class="st">"pair"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># These next few steps are exactly the same as the ones we used above to estimate the partial effects</span></span>
<span>    </span>
<span>    <span class="co"># Generate foreign trade subset</span></span>
<span>    <span class="va">f_trade</span> <span class="op">&lt;-</span> <span class="va">boot_data</span><span class="op">[</span><span class="va">boot_data</span><span class="op">$</span><span class="va">exporter</span> <span class="op">!=</span> <span class="va">boot_data</span><span class="op">$</span><span class="va">importer</span>,<span class="op">]</span></span>
<span></span>
<span>    <span class="co"># Normalize trade data to unit interval</span></span>
<span>    <span class="va">f_trade</span><span class="op">$</span><span class="va">trade</span> <span class="op">&lt;-</span> <span class="va">f_trade</span><span class="op">$</span><span class="va">trade</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">trade</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># classify FEs to be absorbed</span></span>
<span>    <span class="va">f_trade</span><span class="op">$</span><span class="va">exp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span>    <span class="va">f_trade</span><span class="op">$</span><span class="va">imp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span>    <span class="va">f_trade</span><span class="op">$</span><span class="va">pair</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Estimate and save partial effects</span></span>
<span>    <span class="va">save_partials</span><span class="op">[</span><span class="va">b</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/alpaca/man/feglm.html" class="external-link">feglm</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">trade</span> <span class="op">~</span> <span class="va">eu_enlargement</span> <span class="op">+</span> <span class="va">other_fta</span> <span class="op">|</span> <span class="va">exp_year</span> <span class="op">+</span> <span class="va">imp_year</span> <span class="op">+</span> <span class="va">pair</span>,</span>
<span>    data    <span class="op">=</span> <span class="va">f_trade</span>,</span>
<span>    family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">$</span><span class="va">coefficient</span>  <span class="co"># We just need the coefficients for computation</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># Obtain bootstrapped GE results based on bootstrapped partial effects</span></span>
<span><span class="va">bootstrap_GE_results</span> <span class="op">&lt;-</span> <span class="va">ge_baseline_data</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">bootreps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># set up baseline data using the estimated partial effect from bootstrap b</span></span>
<span>  <span class="va">boot_ge_data</span> <span class="op">&lt;-</span> <span class="va">ge_baseline_data</span></span>
<span>  <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">eu_effect</span> <span class="op">&lt;-</span> <span class="va">save_partials</span><span class="op">[</span><span class="va">b</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">new_eu_pair</span> </span>
<span>  </span>
<span>  <span class="co"># run GE_gravity</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ge_gravity.html">ge_gravity</a></span><span class="op">(</span></span>
<span>  exp_id <span class="op">=</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">expcode</span>,    <span class="co"># Origin country associated with each observation</span></span>
<span>  imp_id <span class="op">=</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">impcode</span>,    <span class="co"># Destination country associated with each observation</span></span>
<span>  flows  <span class="op">=</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">trade</span>,      <span class="co"># Observed trade flows in the data for the year being used as the baseline</span></span>
<span>  beta   <span class="op">=</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">eu_effect</span>,  <span class="co"># “Partial” change in trade, obtained as coefficient from gravity estimation</span></span>
<span>  theta  <span class="op">=</span> <span class="fl">4</span>,               <span class="co"># Trade elasticity</span></span>
<span>  mult   <span class="op">=</span> <span class="cn">FALSE</span>,           <span class="co"># Assume trade balance is an additive component of national expenditure</span></span>
<span>  data   <span class="op">=</span> <span class="va">boot_ge_data</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># store results</span></span>
<span>  <span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"welf"</span>,<span class="va">b</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">[</span>,<span class="st">"welfare"</span><span class="op">]</span></span>
<span>  <span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trade"</span>,<span class="va">b</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">[</span>,<span class="st">"new_trade"</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get bootstrapped means, SDs, and 95% CIs for partial effects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">save_partials</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;     0.24045195    -0.03465284</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">save_partials</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;     0.07753165     0.05578904</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">save_partials</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;     0.34988358     0.05572457</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">save_partials</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.025</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;     0.09867022    -0.11837670</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get 95% CIs for GE effects</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="fl">12</span><span class="op">:</span><span class="fl">51</span><span class="op">]</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="st">"lb_welf"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>,<span class="fl">21</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.025</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="st">"ub_welf"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>,<span class="fl">21</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="st">"lb_trade"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.025</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="st">"ub_trade"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">disp_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exporter"</span>,<span class="st">"importer"</span>,<span class="st">"year"</span>,<span class="st">"trade"</span>,<span class="st">"lb_welf"</span>,<span class="st">"ub_welf"</span>,<span class="st">"lb_trade"</span>,<span class="st">"ub_trade"</span><span class="op">)</span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ge_results</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,<span class="va">disp_cols</span><span class="op">]</span> <span class="co"># 10 random rows; GE welfare effects are for *exporter*</span></span>
<span><span class="co">#&gt;      exporter importer year        trade   lb_welf   ub_welf     lb_trade</span></span>
<span><span class="co">#&gt; 1149      CHE      ITA 2000 7.749205e+03 0.9999020 0.9999746 7.752873e+03</span></span>
<span><span class="co">#&gt; 4017      IRL      ROW 2000 1.639069e+04 1.0000977 1.0003829 1.635859e+04</span></span>
<span><span class="co">#&gt; 1557      CYP      RUS 2000 1.165478e+01 1.0035637 1.0141773 1.174513e+01</span></span>
<span><span class="co">#&gt; 3605      IDN      IND 2000 1.156623e+03 0.9999779 0.9999943 1.156626e+03</span></span>
<span><span class="co">#&gt; 5197      MEX      ITA 2000 3.174025e+02 0.9999928 0.9999981 3.175410e+02</span></span>
<span><span class="co">#&gt; 5449      MLT      TWN 2000 9.318681e-01 1.0063494 1.0255347 9.040972e-01</span></span>
<span><span class="co">#&gt; 1093      CHE      CZE 2000 3.707880e+02 0.9999020 0.9999746 3.564777e+02</span></span>
<span><span class="co">#&gt; 497       BEL      ROW 2000 2.142915e+04 1.0001526 1.0006022 2.138667e+04</span></span>
<span><span class="co">#&gt; 7581      USA      BGR 2000 1.377859e+02 0.9999968 0.9999992 1.225898e+02</span></span>
<span><span class="co">#&gt; 6737      SVK      ESP 2000 7.114036e+01 1.0038431 1.0153599 7.871396e+01</span></span>
<span><span class="co">#&gt;          ub_trade</span></span>
<span><span class="co">#&gt; 1149 7.761856e+03</span></span>
<span><span class="co">#&gt; 4017 1.638199e+04</span></span>
<span><span class="co">#&gt; 1557 1.193969e+01</span></span>
<span><span class="co">#&gt; 3605 1.156631e+03</span></span>
<span><span class="co">#&gt; 5197 3.178676e+02</span></span>
<span><span class="co">#&gt; 5449 9.254744e-01</span></span>
<span><span class="co">#&gt; 1093 3.670091e+02</span></span>
<span><span class="co">#&gt; 497  2.141733e+04</span></span>
<span><span class="co">#&gt; 7581 1.334064e+02</span></span>
<span><span class="co">#&gt; 6737 1.012978e+02</span></span></code></pre></div>
<p>Note again that the displayed bounds on welfare estimates refer to
welfare changes for the <em>exporting</em> country.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tom Zylkin, Vadim Kudlay.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
