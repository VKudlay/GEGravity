<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GE_Gravity Theory, Logic, Testing, and Comparison • GEGravity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="GE_Gravity Theory, Logic, Testing, and Comparison">
<meta property="og:description" content="GEGravity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GEGravity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/about.html">GE_Gravity Theory, Logic, Testing, and Comparison</a>
    </li>
    <li>
      <a href="../articles/compare.html">GE_Gravity Logic and Testing</a>
    </li>
    <li>
      <a href="../articles/example.html">GE_Gravity Example</a>
    </li>
    <li>
      <a href="../articles/logic.html">GE_Gravity Logic</a>
    </li>
    <li>
      <a href="../articles/theory.html">GE_Gravity Theory</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/VKudlay/GEGravity/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>GE_Gravity Theory, Logic, Testing, and
Comparison</h1>
                        <h4 data-toc-skip class="author">Tom Zylkin,
Vadim Kudlay</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/VKudlay/GEGravity/blob/HEAD/vignettes/about.Rmd" class="external-link"><code>vignettes/about.Rmd</code></a></small>
      <div class="hidden name"><code>about.Rmd</code></div>

    </div>

    
    
<p>This is a compiled RMD file describing a <code>GEGravity</code> in
more depth. For parameterizations and basic description, see the
documentation i.e. <code><a href="../reference/ge_gravity.html">help(ge_gravity)</a></code>. This is more of an
extension to the formal documentation to keep the <code>help</code>
command from being overbloated.</p>
<p>This overarching file contains all of the contents of
<code>theory.Rmd</code>, <code>example.Rmd</code>,
<code>logic.Rmd</code>, and <code>compare.Rmd</code>, almost in that
order. To see the smaller version, please check out
<code>ge_gravity_rmd</code></p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>As a typical application, consider the following model for
international trade flows: <span class="math display">\[X_{ij}
=\frac{A_{i}w_{i}^{-\theta}\tau_{ij}^{-\theta}}{\sum_{k}A_{k}w_{k}^{-\theta}\tau_{kj}^{-\theta}}E_{j}\]</span></p>
<p><span class="math inline">\(X_{ij}\)</span> are international trade
flows. <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> are indices for origin and destination.
<span class="math inline">\(E_{j} \equiv \sum_{i}X_{ij}\)</span> is
total expenditure (also equal to the sum of the value of shipments
across all origins). <span class="math inline">\(A_{i}\)</span> is a
measure of the level of technology in each origin <span class="math inline">\(i\)</span>, <span class="math inline">\(w_{i}\)</span> is the production cost, and <span class="math inline">\(\tau_{ij} &gt; 1\)</span> is an iceberg trade
cost. The model assumes that goods received from different origins are
imperfectly substitutable and that the degree of substitutability is
governed by <span class="math inline">\(\theta &gt; 0\)</span>, which
serves as a trade elasticity. Labor, <span class="math inline">\(L_{i}\)</span>, is assumed to be the only factor
of production. Trade imbalances, treated as exogenously given, are
accounted for as an additive component of expenditure. Thus, we can also
write national expenditure as the sum of labor income and the national
trade deficit/surplus: <span class="math inline">\(E_{j} = w_{j}L_{j} +
D_{j}\)</span>.</p>
<p>To obtain the effects of changes in trade policies on trade (i.e.,
holding all wages fixed), a standard approach is to estimate using
structural gravity. For example, if we have a panel of trading countries
and we want to know the “average partial effect” of FTAs on trade, we
can estimate the following “three-way” gravity regression:</p>
<p><span class="math display">\[X_{ijt}
=\exp\left[\ln\alpha_{it}+\ln\alpha_{jt}+\ln\alpha_{ij}+\beta\times
FTA_{ijt}\right]+e_{ijt},\]</span></p>
<p>As discussed in Yotov, Piermartini, Monteiro, &amp; Larch (2016), the
estimated <span class="math inline">\(\beta\)</span> from this
specification tells us how much trade would increase on average between
any pair of countries that sign an FTA if we hold fixed all the
endogenous variables in the model. Or, put in more structural terms, it
tells us the direct trade impact of the reduction in trade barriers
associated with an FTA: <span class="math inline">\(\beta=-\theta\Delta\ln\tau_{ijt}\)</span>.</p>
<p>However, often the real goal is to compute changes in real wages,
welfare, and/or trade volumes as a result of a change in trade
frictions. In general equilibrium, the value of a country’s shipments
across all destinations must add up to its labor income (<span class="math inline">\(Y_{i} \equiv w_{i}L_{i} =
\sum_{j}X_{ij}.\)</span>) In other words, we must have that</p>
<p><span class="math display">\[w_{i}L_{i} =\sum_{j}
\frac{A_{i}w_{i}^{-\theta}\tau_{ij}^{-\theta}}
     {\sum_{k}A_{k}w_{k}^{-\theta}\tau_{kj}^{-\theta}}
\left(w_{j}L_{j}+D_{j}\right) \quad \forall i.\]</span></p>
<p>This equation pins down each country’s wages (subject to a
normalization) as a function of how easily it can sell to markets with
high levels of demand. Similarly, notice that we can express the
effective price level in each country, <span class="math inline">\(P_{j}
\equiv
\left[\sum_{k}A_{k}w_{k}^{-\theta}\tau_{kj}^{-\theta}\right]^{-1/\theta}\)</span>,
as a function of how easily a country can buy from producers with high
technology levels and low production costs. These linkages are both
intuitive and general; they can be found in many different trade models
typically used for GE analysis.</p>
<p>A useful point about the system of equations in wages is that it can
be solved in “changes” (as opposed to solving it in levels). Adopting
the notation of Dekle, Eaton, &amp; Kortum (2007), let a “hat” over a
variable denote the change in that variable resulting from a policy
change (e.g., <span class="math inline">\(\widehat{w}_{i}\equiv
w_{i}^{\prime}/w_{i}\)</span> gives the change in <span class="math inline">\(i\)</span>’s wage level.) Noting that <span class="math inline">\(\widehat{\tau}_{ij}^{-\theta}=e^{\beta\times
FTA_{ij}}\)</span>, the “equilibrium in changes” version of wages can be
written as:</p>
<p><span class="math display">\[Y_{i}\widehat{w}_{i} =
\widehat{w}_{i}^{-\theta}
\sum_{j}\frac{\pi_{ij}\cdot e^{\beta \times FTA_{ij}}}
             {\widehat{P}_{j}^{-\theta}}
\cdot\left(Y_{j}\widehat{w}_{j} + D_{j}\right) \quad\forall
i,\]</span></p>
<p>where <span class="math inline">\(\pi_{ij}\equiv
X_{ij}/E_{j}\)</span> is a bilateral trade share and <span class="math inline">\(\widehat{P}_{j}\equiv\left[\sum_{k}\pi_{kj}\widehat{w}_{k}^{-\theta}e^{\beta\times
FTA_{kj}}\right]^{-1/\theta}\)</span> describes the change in price
levels in each country. Notice this equation can be solved without
knowledge of technology levels, endowments, initial trade frictions, or
initial wages. All that is needed are trade volumes, national output and
expenditure levels, and a value for the trade elasticity <span class="math inline">\(\theta\)</span>.</p>
<p>Once changes in wages are known, GE changes in welfare, real wages,
and trade volumes are given respectively by: <span class="math display">\[
\textbf{GE Welfare Impact}:\quad
\widehat{W}_{i}=\widehat{E}_{i}/\widehat{P}_{i}\\ \\
\textbf{GE Real Wage Impact}:\quad
\widehat{rw}_{ij}=\widehat{w}_{i}/\widehat{P}_{i},\\
\textbf{GE Trade Impact}:\quad
\widehat{X}_{ij}=\frac{\widehat{w}_{i}^{-\theta}e^{\beta\times
FTA_{ij}}}{\widehat{P}_{j}^{-\theta}}\cdot\widehat{E}_{j}
\]</span> where the change in national expenditure, <span class="math inline">\(\widehat{E}_{i}\)</span>, is given by <span class="math inline">\((Y_{i}\widehat{w}_{i} + D_{i}) / E_{i}\)</span>.
Because trade volumes are nominal quantities, there is one normalization
needed. For this, the algorithm assumes that total world output is the
same across both the baseline and the counterfactual (i.e., <span class="math inline">\(\sum_{i}Y_{i}\widehat{w}_{i} =
\sum_{i}Y_{i}\)</span>.) The precise method used to solve the model is
described further below.</p>
</div>
<div class="section level2">
<h2 id="algorithm">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm"></a>
</h2>
<p>While there are several ways to solve for counterfactuals in the
above model, the simplest approach is arguably a fixed point algorithm
that repeatedly iterates on the equilibrium conditions of the model.
There are numerous ways to implement such an algorithm, but the approach
used in Baier, Yotov, &amp; Zylkin (2019) is especially simple to
program. We first initialize <span class="math inline">\(\widehat{w}_{i}=\widehat{P}_{i}^{-\theta}=1\)</span>
<span class="math inline">\(\forall i\)</span> and <span class="math inline">\(E_{i}^{\prime}=E_{i}\)</span><span class="math inline">\(\forall i\)</span>. The iteration loop then
requires only 4 steps:</p>
<ol style="list-style-type: decimal">
<li><p>Update <span class="math inline">\(\widehat{w}_{i}\)</span> <span class="math inline">\(\forall\)</span> <span class="math inline">\(i\)</span> one time using <span class="math display">\[\widehat{w}_{i} =
\left[Y_{i}^{-1}\sum_{j}\frac{\pi_{ij}\cdot
e^{\beta\times FTA_{ij}}}{\widehat{P}_{j}^{-\theta}}\cdot
E_{j}^{\prime}\right]^{\frac{1}{1+\theta}}\quad\forall
i.\]</span></p></li>
<li><p>Normalize all wages so that world output stays fixed: <span class="math inline">\(\sum_{i}Y_{i}\widehat{w}_{i}=\sum_{i}Y_{i}\)</span>.</p></li>
<li><p>Update <span class="math inline">\(\widehat{P}_{j}^{-\theta}=\left[\sum_{k}\pi_{kj}\widehat{w}_{k}^{-\theta}e^{b\times
FTA_{kj}}\right]\)</span> <span class="math inline">\(\forall\)</span>
<span class="math inline">\(j\)</span>.</p></li>
<li><p>Update <span class="math inline">\(E_{j}^{\prime}=Y_{j}\widehat{w}_{j}+D_{j}\)</span>
<span class="math inline">\(\forall\)</span> <span class="math inline">\(j\)</span>.</p></li>
</ol>
<ul>
<li>(Repeat steps 1-4 until convergence.)</li>
</ul>
<p>This algorithm is very similar to one previously made available by
Head &amp; Mayer (2014), but takes a slightly more streamlined approach
to updating wages in step 1. It should generally be very fast because it
does not involve using a nonlinear solver.</p>
<hr>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>For an example, the package comes with example data
<code>TradeData0014</code>. The data set consists of a panel of 44
countries trading with one another over the years 2000-2014. The trade
data uses aggregated trade flows based on <a href="http://www.wiod.org/database/wiots16" class="external-link">WIOD</a> and information on
FTAs is from the <a href="https://sites.nd.edu/jeffrey-bergstrand/database-on-economic-integration-agreements/" class="external-link">NSF-Kellogg
database</a> maintained by Scott Baier and Jeff Bergstrand. To find out
more about the trade data, see <a href="https://www.researchgate.net/publication/274731196_An_Illustrated_User_Guide_to_the_World_Input-Output_Database_The_Case_of_Global_Automotive_Production" class="external-link">Timmer,
Dietzenbacher, Los, Stehrer, and de Vries (2015)</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">TradeData0014</span><span class="op">)</span> <span class="co"># loads data included with package</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">TradeData0014</span><span class="op">)</span> </span>
<span><span class="co">#&gt;   exporter importer expcode impcode year        trade eu_enlargement other_fta</span></span>
<span><span class="co">#&gt; 1      AUS      AUS       1       1 2000 7.047775e+05              0         1</span></span>
<span><span class="co">#&gt; 2      AUS      AUS       1       1 2005 1.334877e+06              0         1</span></span>
<span><span class="co">#&gt; 3      AUS      AUS       1       1 2010 2.210350e+06              0         1</span></span>
<span><span class="co">#&gt; 4      AUS      AUS       1       1 2014 2.436575e+06              0         1</span></span>
<span><span class="co">#&gt; 5      AUS      AUT       1       2 2000 6.195446e+01              0         0</span></span>
<span><span class="co">#&gt; 6      AUS      AUT       1       2 2005 1.407591e+02              0         0</span></span>
<span><span class="co">#&gt;   FTA</span></span>
<span><span class="co">#&gt; 1   1</span></span>
<span><span class="co">#&gt; 2   1</span></span>
<span><span class="co">#&gt; 3   1</span></span>
<span><span class="co">#&gt; 4   1</span></span>
<span><span class="co">#&gt; 5   0</span></span>
<span><span class="co">#&gt; 6   0</span></span></code></pre></div>
<p>Suppose the researcher wishes to use this data set to quantify
general equilibrium trade and welfare effects of the EU enlargements
that took place between 2000-2014. To first obtain the partial effects
of these enlargements on trade flows, a PPML (Poisson pseudo-maximum
likelihood) gravity specification may be used. Specifically, to obtain
the “partial” estimates of the effects of EU enlargements on trade, we
can use the following three-way gravity specification:</p>
<p><span class="math display">\[X_{ijt} = \exp\bigg[\ln(\alpha_{it}) +
\ln(\alpha_{jt}) + \ln(\alpha_{ij}) + \beta \cdot FTA_{ijt}\bigg] +
e_{ijt}\]</span></p>
<p>The Stata equivalent of this package uses the ppmlhdfe command
created by Correia, Guimarães, &amp; Zylkin (2019) to achieve this. In
our example, we will use the <a href="https://CRAN.R-project.org/package=alpaca" class="external-link">‘alpaca’ library</a> by
Amrei Stammann to do the same via the <code>feglm</code> (Fixed-Effect
Generalized Linear Model) function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amrei-stammann/alpaca" class="external-link">alpaca</a></span><span class="op">)</span>  <span class="co"># Needed for partial coefficients</span></span>
<span></span>
<span><span class="co"># Generate foreign trade subset</span></span>
<span><span class="va">f_trade</span> <span class="op">&lt;-</span> <span class="va">TradeData0014</span><span class="op">[</span><span class="va">TradeData0014</span><span class="op">$</span><span class="va">exporter</span> <span class="op">!=</span> <span class="va">TradeData0014</span><span class="op">$</span><span class="va">importer</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># classify FEs for components to be absorbed (finding variable interactions)</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">exp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">imp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">pair</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit generalized linear model based on specifications</span></span>
<span><span class="va">partials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/alpaca/man/feglm.html" class="external-link">feglm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">trade</span> <span class="op">~</span> <span class="va">eu_enlargement</span> <span class="op">+</span> <span class="va">other_fta</span> <span class="op">|</span> <span class="va">exp_year</span> <span class="op">+</span> <span class="va">imp_year</span> <span class="op">+</span> <span class="va">pair</span>,</span>
<span>  data    <span class="op">=</span> <span class="va">f_trade</span>,</span>
<span>  family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">coefficient</span>  <span class="co"># We just need the coefficients for computation</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">partials</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;          0.224         -0.037</span></span></code></pre></div>
<p>In addition to estimating the effects of EU enlargements on new EU
pairs, this example also controls for any other FTAs signed during the
period. Each of these variables is coded as a dummy variable that
becomes 1 when the agreement goes into effect for a given pair. The
estimated coefficient for <code>eu_enlargements</code> is 0.224,
implying that the expansion of the EU had an average partial effect of
<span class="math inline">\(e^{0.224} − 1 = 25.1\%\)</span> on trade
between new EU members and existing members. With clustered standard
errors, this estimate is statistically significant at the <span class="math inline">\(p &lt; .01\)</span> significance level.</p>
<hr>
<p>Before proceeding, some further pre-processing is needed.
Specifically, we need to supply the function with the partial effects of
joining the EU estimated above for each of the appropriate pairs. To do
this, we create a new variable whose value is either the eu_enlargement
partial computed above or 0.</p>
<p>For Stata users, the Stata equivalent of this next step is:</p>
<pre><code>sort exporter importer year
by exporter importer: gen new_eu_pair = (eu_enlargement[_N]-eu_enlargement[1])                   
by exporter importer: gen eu_effect = _b[eu_enlargement] * new_eu_pair</code></pre>
<p>In R, we do the following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sort matrix to make it easier to find imp/exp pairs</span></span>
<span><span class="va">t_trade</span> <span class="op">&lt;-</span> <span class="va">TradeData0014</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span></span>
<span>  <span class="va">TradeData0014</span><span class="op">$</span><span class="va">exporter</span>,</span>
<span>  <span class="va">TradeData0014</span><span class="op">$</span><span class="va">importer</span>,</span>
<span>  <span class="va">TradeData0014</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>,</span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">t_trade</span><span class="op">$</span><span class="va">new_eu_pair</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">t_trade</span><span class="op">$</span><span class="va">eu_effect</span>   <span class="op">&lt;-</span> <span class="cn">NA</span>   <span class="co"># this creates a new column that will contain partial effect of EU membership for new EU pairs</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Effect of EU entrance on country based on partial, if entry happened</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">t_trade</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">t_trade</span><span class="op">$</span><span class="va">expcode</span>, <span class="va">t_trade</span><span class="op">$</span><span class="va">impcode</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Was a new EU pair created within time span?</span></span>
<span>  <span class="va">t_trade</span><span class="op">[</span><span class="va">i</span><span class="op">:</span><span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="st">"new_eu_pair"</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">row</span><span class="op">$</span><span class="va">eu_enlargement</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If added to EU, give it the computed partial eu_enlargement coefficient (0.224) as the effect</span></span>
<span><span class="va">t_trade</span><span class="op">$</span><span class="va">eu_effect</span> <span class="op">=</span> <span class="va">t_trade</span><span class="op">$</span><span class="va">new_eu_pair</span> <span class="op">*</span> <span class="va">partials</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>To finalize the data for the counterfactual, we will use the year
2000 as the baseline year. The data we will feed to the ‘ge_gravity’
command looks like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Data to be finally fed to the function (we base the counterfactual on the year 2000.)</span></span>
<span><span class="va">ge_baseline_data</span> <span class="op">&lt;-</span> <span class="va">t_trade</span><span class="op">[</span><span class="va">t_trade</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2000</span>,<span class="op">]</span>   <span class="co"># In example, 1892 Entries, 5676 removed</span></span>
<span></span>
<span><span class="co"># head(data) # First 10 rows</span></span>
<span><span class="va">ge_baseline_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ge_baseline_data</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,<span class="op">]</span>  <span class="co"># 10 random rows</span></span>
<span><span class="co">#&gt;      exporter importer expcode impcode year      trade eu_enlargement other_fta</span></span>
<span><span class="co">#&gt; 6289      ROU      NOR      36      33 2000   70.42168              0         1</span></span>
<span><span class="co">#&gt; 2277      ESP      TUR      13      42 2000 1660.11632              0         1</span></span>
<span><span class="co">#&gt; 6077      PRT      ITA      35      24 2000  893.41356              1         0</span></span>
<span><span class="co">#&gt; 1873      DEU      LVA      11      29 2000  411.83237              0         1</span></span>
<span><span class="co">#&gt; 2433      EST      ROW      14      37 2000  499.42945              0         1</span></span>
<span><span class="co">#&gt; 5509      NLD      EST      32      14 2000   45.65391              0         1</span></span>
<span><span class="co">#&gt; 7549      TWN      SVN      43      40 2000   48.57555              0         0</span></span>
<span><span class="co">#&gt; 4345      JPN      MLT      25      31 2000   34.98560              0         0</span></span>
<span><span class="co">#&gt; 6589      RUS      HUN      38      20 2000 1749.76171              0         0</span></span>
<span><span class="co">#&gt; 6045      PRT      FRA      35      16 2000 2468.06835              1         0</span></span>
<span><span class="co">#&gt;      FTA new_eu_pair eu_effect</span></span>
<span><span class="co">#&gt; 6289   1           1  0.224249</span></span>
<span><span class="co">#&gt; 2277   1           0  0.000000</span></span>
<span><span class="co">#&gt; 6077   1           0  0.000000</span></span>
<span><span class="co">#&gt; 1873   1           1  0.224249</span></span>
<span><span class="co">#&gt; 2433   1           0  0.000000</span></span>
<span><span class="co">#&gt; 5509   1           1  0.224249</span></span>
<span><span class="co">#&gt; 7549   0           0  0.000000</span></span>
<span><span class="co">#&gt; 4345   0           0  0.000000</span></span>
<span><span class="co">#&gt; 6589   0           0  0.000000</span></span>
<span><span class="co">#&gt; 6045   1           0  0.000000</span></span></code></pre></div>
<p>Now that we have the data we need, we can run the ‘ge_gravity’
function as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ge_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ge_gravity.html">ge_gravity</a></span><span class="op">(</span></span>
<span>  exp_id <span class="op">=</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">expcode</span>,    <span class="co"># Origin country associated with each observation</span></span>
<span>  imp_id <span class="op">=</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">impcode</span>,    <span class="co"># Destination country associated with each observation</span></span>
<span>  flows  <span class="op">=</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">trade</span>,      <span class="co"># Observed trade flows in the data for the year being used as the baseline</span></span>
<span>  beta   <span class="op">=</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">eu_effect</span>,  <span class="co"># “Partial” change in trade, obtained as coefficient from gravity estimation</span></span>
<span>  theta  <span class="op">=</span> <span class="fl">4</span>,               <span class="co"># Trade elasticity</span></span>
<span>  mult   <span class="op">=</span> <span class="cn">FALSE</span>,           <span class="co"># Assume trade balance is an additive component of national expenditure</span></span>
<span>  data   <span class="op">=</span> <span class="va">ge_baseline_data</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ge_results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ge_results</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">12</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">]</span> <span class="co"># 10 random rows</span></span>
<span><span class="co">#&gt;      exporter importer year        trade    new_trade   welfare real_wage</span></span>
<span><span class="co">#&gt; 6429      ROW      ITA 2000 49686.811375 49744.775334 0.9999777 0.9999755</span></span>
<span><span class="co">#&gt; 485       BEL      POL 2000  1205.238414  1474.227573 1.0003657 1.0003587</span></span>
<span><span class="co">#&gt; 5629      NLD      USA 2000 13529.090121 13517.603220 1.0003121 1.0003057</span></span>
<span><span class="co">#&gt; 6893      SVN      CHN 2000    12.574958    12.716478 1.0118017 1.0116019</span></span>
<span><span class="co">#&gt; 4801      LUX      ESP 2000   499.658201   499.641771 1.0002503 1.0002389</span></span>
<span><span class="co">#&gt; 1605      CZE      CAN 2000    93.113561    91.955797 1.0099827 1.0099972</span></span>
<span><span class="co">#&gt; 3573      IDN      EST 2000     1.509861     1.460711 0.9999865 0.9999931</span></span>
<span><span class="co">#&gt; 2809      FRA      TWN 2000  2339.693451  2336.041658 1.0001980 1.0001950</span></span>
<span><span class="co">#&gt; 6085      PRT      KOR 2000    13.042367    13.041252 1.0000813 1.0000725</span></span>
<span><span class="co">#&gt; 3869      IND      USA 2000 10715.495243 10715.810196 0.9999966 0.9999961</span></span>
<span><span class="co">#&gt;       nom_wage price_index</span></span>
<span><span class="co">#&gt; 6429 0.9998898   0.9999143</span></span>
<span><span class="co">#&gt; 485  1.0002030   0.9998443</span></span>
<span><span class="co">#&gt; 5629 1.0001322   0.9998266</span></span>
<span><span class="co">#&gt; 6893 0.9970762   0.9856409</span></span>
<span><span class="co">#&gt; 4801 1.0001388   0.9998999</span></span>
<span><span class="co">#&gt; 1605 1.0030564   0.9931279</span></span>
<span><span class="co">#&gt; 3573 0.9998933   0.9999002</span></span>
<span><span class="co">#&gt; 2809 1.0002656   1.0000706</span></span>
<span><span class="co">#&gt; 6085 0.9998933   0.9998208</span></span>
<span><span class="co">#&gt; 3869 0.9999125   0.9999164</span></span></code></pre></div>
<p>This assumes a standard trade elasticity value of <span class="math inline">\(\theta = 4\)</span>. The input for <span class="math inline">\(\beta\)</span> is given by the variable we created
called <code>eu_effect</code>, which is equal to 0.224 for new EU pairs
formed during the period and equal to 0 otherwise. Because of the small
size of the sample, it solves almost instantly. Sample results for the
first 10 rows in the data are shown above for the counterfactual trade
level and the associated changes in welfare, real wages, nomimal wages,
and the local price index. Click on the right arrow to scroll to the
right if they are not all displayed above. For the latter four
variables, the number shown is the result computed for the
<em>exporting</em> country. Unsurprisingly, the new EU members
(Bulgaria, Croatia, Czech Republic, Estonia, Hungary, Latvia, Lithuania,
Malta, Poland, Romania, Slovakia, and Slovenia) realize the largest
welfare gains from their joining the EU, with existing EU countries also
gaining. All countries not included in the agreement experience small
losses due to trade diversion, with the largest losses accruing to
Russia.</p>
<p>We can also change how trade imbalances enter the model. The default
(exibited above with mult = FALSE) is to assume that they enter
expenditure additively (i.e., <span class="math inline">\(E_j = Y_j +
D_j\)</span>), but one can also change the model so that expenditure is
instead a fixed multiple of income (i.e., let <span class="math inline">\(E_j = \delta_j Y_j\)</span>.) by setting
<code>mult = TRUE</code>. While using multiplicative imbalances instead
of additive balances changes the results slightly, they are still
qualitatively very similar.</p>
<p>An important point about the above exercises is that the initial
partial effect is estimated with some uncertainty. The GE results that
were calculated may paint a misleading picture because they do not take
this uncertainty into account. For this reason, it is considered good
practice to use a bootstrap method to construct confidence intervals for
the GE calculations. This type of procedure can be made easier using
<code>ge_gravity</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>  <span class="co"># needed below for bootstrap procedure</span></span>
<span></span>
<span><span class="co"># Helper function for shuffling the data with replacement.</span></span>
<span><span class="co"># This allows us to shuffle by pair rather than treating each observation as independent.</span></span>
<span><span class="va">get_bootdata</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,<span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">uniq_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="va">id</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">draw</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">uniq_id</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">draw</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">draw</span><span class="op">)</span><span class="op">[</span>,<span class="va">.N</span>,by<span class="op">=</span><span class="va">draw</span><span class="op">]</span>  <span class="co"># count duplicate pairs in bootstrap sample</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">draw</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">id</span></span>
<span>  <span class="va">boot_data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">draw</span>,<span class="st">"pair"</span>,all.x<span class="op">=</span><span class="cn">FALSE</span>,all.y<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">boot_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">boot_data</span><span class="op">)</span>, <span class="va">boot_data</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>  <span class="co"># replicates pairs drawn multiple times after merge</span></span>
<span>  <span class="va">boot_data</span>  <span class="op">&lt;-</span> <span class="va">boot_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">boot_index</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">boot_data</span><span class="op">$</span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">boot_data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">boot_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># set up for pair bootstrap</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span>
<span><span class="va">bootreps</span>      <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">TradeData0014</span><span class="op">[</span>,<span class="st">"pair"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">TradeData0014</span><span class="op">$</span><span class="va">expcode</span>,<span class="va">TradeData0014</span><span class="op">$</span><span class="va">impcode</span><span class="op">)</span> <span class="co"># This is the ID we will use for resampling.</span></span>
<span></span>
<span><span class="co"># Initialize matrices for saving results</span></span>
<span><span class="va">x</span>             <span class="op">&lt;-</span> <span class="va">TradeData0014</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eu_enlargement"</span>,<span class="st">"other_fta"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">save_partials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">bootreps</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bootreps</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">GE_effects</span>    <span class="op">&lt;-</span> <span class="va">ge_results</span><span class="op">[</span>,<span class="fl">11</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span></span>
<span><span class="va">save_GE</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">bootreps</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">GE_effects</span><span class="op">)</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bootreps</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">GE_effects</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate bootstrapped gravity estimates using alpaca's feglm function (20 boot reps)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amrei-stammann/alpaca" class="external-link">alpaca</a></span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">bootreps</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># This step shuffles the data using the get_bootdata() function defined above</span></span>
<span>    <span class="va">boot_data</span> <span class="op">&lt;-</span> <span class="fu">get_bootdata</span><span class="op">(</span><span class="va">TradeData0014</span>,<span class="st">"pair"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># These next few steps are exactly the same as the ones we used above to estimate the partial effects</span></span>
<span>    </span>
<span>    <span class="co"># Generate foreign trade subset</span></span>
<span>    <span class="va">f_trade</span> <span class="op">&lt;-</span> <span class="va">boot_data</span><span class="op">[</span><span class="va">boot_data</span><span class="op">$</span><span class="va">exporter</span> <span class="op">!=</span> <span class="va">boot_data</span><span class="op">$</span><span class="va">importer</span>,<span class="op">]</span></span>
<span></span>
<span>    <span class="co"># classify FEs to be absorbed</span></span>
<span>    <span class="va">f_trade</span><span class="op">$</span><span class="va">exp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span>    <span class="va">f_trade</span><span class="op">$</span><span class="va">imp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span>    <span class="va">f_trade</span><span class="op">$</span><span class="va">pair</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Estimate and save partial effects</span></span>
<span>    <span class="va">save_partials</span><span class="op">[</span><span class="va">b</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/alpaca/man/feglm.html" class="external-link">feglm</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">trade</span> <span class="op">~</span> <span class="va">eu_enlargement</span> <span class="op">+</span> <span class="va">other_fta</span> <span class="op">|</span> <span class="va">exp_year</span> <span class="op">+</span> <span class="va">imp_year</span> <span class="op">+</span> <span class="va">pair</span>,</span>
<span>    data    <span class="op">=</span> <span class="va">f_trade</span>,</span>
<span>    family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">$</span><span class="va">coefficient</span>  <span class="co"># We just need the coefficients for computation</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Obtain bootstrapped GE results based on bootstrapped partial effects</span></span>
<span><span class="va">bootstrap_GE_results</span> <span class="op">&lt;-</span> <span class="va">ge_baseline_data</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">bootreps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># set up baseline data using the estimated partial effect from bootstrap b</span></span>
<span>  <span class="va">boot_ge_data</span> <span class="op">&lt;-</span> <span class="va">ge_baseline_data</span></span>
<span>  <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">eu_effect</span> <span class="op">&lt;-</span> <span class="va">save_partials</span><span class="op">[</span><span class="va">b</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">new_eu_pair</span> </span>
<span>  </span>
<span>  <span class="co"># run GE_gravity</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ge_gravity.html">ge_gravity</a></span><span class="op">(</span></span>
<span>  exp_id <span class="op">=</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">expcode</span>,    <span class="co"># Origin country associated with each observation</span></span>
<span>  imp_id <span class="op">=</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">impcode</span>,    <span class="co"># Destination country associated with each observation</span></span>
<span>  flows  <span class="op">=</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">trade</span>,      <span class="co"># Observed trade flows in the data for the year being used as the baseline</span></span>
<span>  beta   <span class="op">=</span> <span class="va">boot_ge_data</span><span class="op">$</span><span class="va">eu_effect</span>,  <span class="co"># “Partial” change in trade, obtained as coefficient from gravity estimation</span></span>
<span>  theta  <span class="op">=</span> <span class="fl">4</span>,               <span class="co"># Trade elasticity</span></span>
<span>  mult   <span class="op">=</span> <span class="cn">FALSE</span>,           <span class="co"># Assume trade balance is an additive component of national expenditure</span></span>
<span>  data   <span class="op">=</span> <span class="va">boot_ge_data</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># store results</span></span>
<span>  <span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"welf"</span>,<span class="va">b</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">[</span>,<span class="st">"welfare"</span><span class="op">]</span></span>
<span>  <span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trade"</span>,<span class="va">b</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">[</span>,<span class="st">"new_trade"</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get bootstrapped means, SDs, and 95% CIs for partial effects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">save_partials</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;     0.24045195    -0.03465284</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">save_partials</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;     0.07753165     0.05578904</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">save_partials</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;     0.34988358     0.05572457</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">save_partials</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.025</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; eu_enlargement      other_fta </span></span>
<span><span class="co">#&gt;     0.09867022    -0.11837670</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get 95% CIs for GE effects</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="fl">12</span><span class="op">:</span><span class="fl">51</span><span class="op">]</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="st">"lb_welf"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>,<span class="fl">21</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.025</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="st">"ub_welf"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>,<span class="fl">21</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="st">"lb_trade"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.025</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span>,<span class="st">"ub_trade"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">disp_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exporter"</span>,<span class="st">"importer"</span>,<span class="st">"year"</span>,<span class="st">"trade"</span>,<span class="st">"lb_welf"</span>,<span class="st">"ub_welf"</span>,<span class="st">"lb_trade"</span>,<span class="st">"ub_trade"</span><span class="op">)</span></span>
<span><span class="va">bootstrap_GE_results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ge_results</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,<span class="va">disp_cols</span><span class="op">]</span> <span class="co"># 10 random rows; GE welfare effects are for *exporter*</span></span>
<span><span class="co">#&gt;      exporter importer year        trade   lb_welf   ub_welf     lb_trade</span></span>
<span><span class="co">#&gt; 1149      CHE      ITA 2000 7.749205e+03 0.9999020 0.9999746 7.752873e+03</span></span>
<span><span class="co">#&gt; 4017      IRL      ROW 2000 1.639069e+04 1.0000977 1.0003829 1.635859e+04</span></span>
<span><span class="co">#&gt; 1557      CYP      RUS 2000 1.165478e+01 1.0035637 1.0141773 1.174513e+01</span></span>
<span><span class="co">#&gt; 3605      IDN      IND 2000 1.156623e+03 0.9999779 0.9999943 1.156626e+03</span></span>
<span><span class="co">#&gt; 5197      MEX      ITA 2000 3.174025e+02 0.9999928 0.9999981 3.175410e+02</span></span>
<span><span class="co">#&gt; 5449      MLT      TWN 2000 9.318681e-01 1.0063494 1.0255347 9.040972e-01</span></span>
<span><span class="co">#&gt; 1093      CHE      CZE 2000 3.707880e+02 0.9999020 0.9999746 3.564777e+02</span></span>
<span><span class="co">#&gt; 497       BEL      ROW 2000 2.142915e+04 1.0001526 1.0006022 2.138667e+04</span></span>
<span><span class="co">#&gt; 7581      USA      BGR 2000 1.377859e+02 0.9999968 0.9999992 1.225898e+02</span></span>
<span><span class="co">#&gt; 6737      SVK      ESP 2000 7.114036e+01 1.0038431 1.0153599 7.871396e+01</span></span>
<span><span class="co">#&gt;          ub_trade</span></span>
<span><span class="co">#&gt; 1149 7.761856e+03</span></span>
<span><span class="co">#&gt; 4017 1.638199e+04</span></span>
<span><span class="co">#&gt; 1557 1.193969e+01</span></span>
<span><span class="co">#&gt; 3605 1.156631e+03</span></span>
<span><span class="co">#&gt; 5197 3.178676e+02</span></span>
<span><span class="co">#&gt; 5449 9.254744e-01</span></span>
<span><span class="co">#&gt; 1093 3.670091e+02</span></span>
<span><span class="co">#&gt; 497  2.141733e+04</span></span>
<span><span class="co">#&gt; 7581 1.334064e+02</span></span>
<span><span class="co">#&gt; 6737 1.012978e+02</span></span></code></pre></div>
<p>Note again that the displayed bounds on welfare estimates refer to
welfare changes for the <em>exporting</em> country.</p>
<hr>
</div>
<div class="section level2">
<h2 id="program-execution">Program Execution<a class="anchor" aria-label="anchor" href="#program-execution"></a>
</h2>
<p>Instead of calling the function, let’s assume that we have the
variables set as following:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_id</span> <span class="op">&lt;-</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">expcode</span></span>
<span><span class="va">imp_id</span> <span class="op">&lt;-</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">impcode</span></span>
<span><span class="va">flows</span>  <span class="op">&lt;-</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">trade</span></span>
<span><span class="va">beta</span>   <span class="op">&lt;-</span> <span class="va">ge_baseline_data</span><span class="op">$</span><span class="va">eu_effect</span></span>
<span><span class="va">theta</span>  <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">mult</span>   <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
<p>In the following, we are going to trace and test the algorithm as if
it were being called.</p>
<p>As an assumption: - <span class="math inline">\(i\)</span> indices
are defined for each origin/exporter, and matrices enumerable by them
are Nx1 matrices. Sums for all <span class="math inline">\(i\)</span>
are generally defined by colSums - <span class="math inline">\(j\)</span> indices are defined for each
destination/importer, and matrices enumerable by them are 1xN matrices.
Sums for all <span class="math inline">\(j\)</span> are generally
defined by rowSums - Column- and Row-wise summations will be done
explicitly, and R’s vector math operations will not be assumed to
facilitate it.</p>
<p>To be safe and explanatory, we will also define a few functions: -
Typesafe function <code>ts</code> that can verify that our initial
dimensions hold and that no <span class="math inline">\(\texttt{NA}\)</span> values are introduced. -
Sanity function <code>sanity</code> that will make sure that a
vector/matrix does not change cardinality illogically. -
<code>printHead</code> to show only a tiny subset of data without much
code.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">printHead</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Vec</span>, <span class="va">rows</span> <span class="op">=</span> <span class="fl">6</span>, <span class="va">cols</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Vec</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">rows</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Vec</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cols</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Vec</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Vec</span>, <span class="va">Val</span>, <span class="va">line</span> <span class="op">=</span> <span class="st">"?"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Vec</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Val</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Vec</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Val</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">" &gt; Assigned vector has improper dimensions on line"</span>, <span class="va">line</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Assigning value: \n"</span><span class="op">)</span></span>
<span>    <span class="fu">printHead</span><span class="op">(</span><span class="va">Val</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"To Value: \n"</span><span class="op">)</span></span>
<span>    <span class="fu">printHead</span><span class="op">(</span><span class="va">Vec</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="st">"q"</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">anyNA</a></span><span class="op">(</span><span class="va">Val</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">" &gt; Assigned vector has NAs on line"</span>, <span class="va">line</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">printHead</span><span class="op">(</span><span class="va">Val</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="st">"q"</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Val</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sanity</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span>, <span class="va">Vec</span>, <span class="va">dstr</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">" &gt; Sanity Check: "</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Vec</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  - dim("</span>, <span class="va">name</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">") = "</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Vec</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">" x "</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Vec</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>      <span class="st">" (defined for "</span>, <span class="va">dstr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">")"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let us first set up the set of international trade flows matrix,
<span class="math inline">\(X_{ij}\)</span> (w/ <span class="math inline">\(i\)</span> exporting to <span class="math inline">\(j\)</span>). This is just the set of flows
arranged in an exporter (rows) by importer (columns) fashion.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span>   <span class="op">&lt;-</span> <span class="va">flows</span></span>
<span><span class="va">n</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>        <span class="co"># Length of row or column of trade matrix</span></span>
<span><span class="va">X</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">flows</span>, <span class="va">n</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="co"># Square the matrix</span></span>
<span><span class="fu">printHead</span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="co">#&gt;              [,1]         [,2]        [,3]        [,4]         [,5]</span></span>
<span><span class="co">#&gt; [1,] 7.047775e+05     61.95446    345.4675     5.71090 5.577426e+02</span></span>
<span><span class="co">#&gt; [2,] 3.658264e+02 261390.90409   1224.3476   144.50709 2.635246e+02</span></span>
<span><span class="co">#&gt; [3,] 4.753819e+02   1516.67071 343253.2434    68.76933 4.872147e+02</span></span>
<span><span class="co">#&gt; [4,] 7.448854e-01     17.67560    111.4472 25137.17943 1.040889e+00</span></span>
<span><span class="co">#&gt; [5,] 4.858000e+02    221.86748   1308.2011    47.55200 1.086039e+06</span></span>
<span><span class="co">#&gt; [6,] 1.437038e+03    659.92572   1136.6122     7.58329 8.533425e+02</span></span>
<span><span class="co">#&gt;              [,6]</span></span>
<span><span class="co">#&gt; [1,] 1.583679e+03</span></span>
<span><span class="co">#&gt; [2,] 8.459328e+02</span></span>
<span><span class="co">#&gt; [3,] 6.059549e+02</span></span>
<span><span class="co">#&gt; [4,] 1.269456e+01</span></span>
<span><span class="co">#&gt; [5,] 8.835362e+02</span></span>
<span><span class="co">#&gt; [6,] 1.066313e+06</span></span></code></pre></div>
<p>Then, set <span class="math inline">\({\texttt B} \ (=
e^{\beta})\)</span> to be the matrix of partial effects. Notice that the
diagonal must be set to 0.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">B</span> <span class="op">&lt;-</span> <span class="va">beta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span> <span class="co"># Format B to have K.n columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span>       <span class="co"># Set diagonal to 0 (this is required and is corrected if found)</span></span>
<span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span>
<span><span class="fu">printHead</span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]     [,2]     [,3]     [,4] [,5] [,6]</span></span>
<span><span class="co">#&gt; [1,]    1 1.000000 1.000000 1.000000    1    1</span></span>
<span><span class="co">#&gt; [2,]    1 1.000000 1.000000 1.251383    1    1</span></span>
<span><span class="co">#&gt; [3,]    1 1.000000 1.000000 1.251383    1    1</span></span>
<span><span class="co">#&gt; [4,]    1 1.251383 1.251383 1.000000    1    1</span></span>
<span><span class="co">#&gt; [5,]    1 1.000000 1.000000 1.000000    1    1</span></span>
<span><span class="co">#&gt; [6,]    1 1.000000 1.000000 1.000000    1    1</span></span></code></pre></div>
<p>Now, we can set up some more variables:</p>
<ul>
<li><p>Let <span class="math inline">\(E_j\)</span> be the Total
National Expendatures for country <span class="math inline">\(j\)</span>
such that <span class="math inline">\(E_j \equiv \sum_i
X_{ij}\)</span>.</p></li>
<li><p>Let <span class="math inline">\(Y_j\)</span> be the Total Labor
Income for country <span class="math inline">\(i\)</span> such that
<span class="math inline">\(Y_i \equiv w_iL_j = \sum_j
X_{ij}\)</span>.</p></li>
<li><p>Let <span class="math inline">\(D_j\)</span> be the National
Trade Deficit for country <span class="math inline">\(j\)</span> such
that <span class="math inline">\(D_j \equiv E_j - Yj\)</span>.</p></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up Y, E, D vectors; calculate trade balances</span></span>
<span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="va">n</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># Total National Expendatures; Value of import for all origin</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="va">n</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># Total Labor Income; Value of exports for all destinations;</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="va">E</span> <span class="op">-</span> <span class="va">Y</span>                    <span class="co"># D: National trade deficit / surplus</span></span>
<span></span>
<span><span class="fu">sanity</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"E"</span>,<span class="st">"Y"</span>,<span class="st">"D"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">E</span>, <span class="va">Y</span>, <span class="va">D</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"j"</span>,<span class="st">"j"</span>,<span class="st">"j"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  &gt; Sanity Check:</span></span>
<span><span class="co">#&gt;   - dim(E) = 44 x 1 (defined for j)</span></span>
<span><span class="co">#&gt;   - dim(Y) = 44 x 1 (defined for j)</span></span>
<span><span class="co">#&gt;   - dim(D) = 44 x 1 (defined for j)</span></span></code></pre></div>
<p>Then we set up the <span class="math inline">\(\pi_{ij}\)</span>
matrix of bilateral trade shares such that <span class="math inline">\(\pi_{ij} = X_{ij}/E_{j}\)</span>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set up pi_ij matrix of trade shares; pi_ij = X_ij/E_j</span></span>
<span><span class="va">Pi</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Bilateral trade share</span></span>
<span><span class="fu">sanity</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"i and j"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  &gt; Sanity Check:</span></span>
<span><span class="co">#&gt;   - dim(X) = 44 x 44 (defined for i and j)</span></span></code></pre></div>
<p>Now, we are almost done. In this model, we want to build up:</p>
<ul>
<li><p>The change in price levels in each country <span class="math inline">\(\hat{P_j}\)</span> for all exporters.</p></li>
<li><p>The change in welfare <span class="math inline">\(\hat{W}_{j}\)</span> for all exporters.</p></li>
<li><p>The general equilibrium trade impact (GETI) <span class="math inline">\(\hat{X}_{ij}\)</span> between all exporters and
importers.</p></li>
</ul>
<p>The iterative algorithm provided will build these up iteratively,
starting them off as 1-column matrices.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w_hat</span> <span class="op">&lt;-</span> <span class="va">P_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, <span class="fl">1</span><span class="op">)</span>   <span class="co"># Containers for running w_hat and P_hat</span></span>
<span><span class="va">X_new</span> <span class="op">&lt;-</span> <span class="va">X</span>                          <span class="co"># Container for updated X</span></span>
<span><span class="fu">sanity</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_hat"</span>, <span class="st">"P_hat"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">w_hat</span>, <span class="va">P_hat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"i"</span>, <span class="st">"i"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  &gt; Sanity Check:</span></span>
<span><span class="co">#&gt;   - dim(w_hat) = 44 x 1 (defined for i)</span></span>
<span><span class="co">#&gt;   - dim(P_hat) = 44 x 1 (defined for i)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="loop-processes">Loop Processes<a class="anchor" aria-label="anchor" href="#loop-processes"></a>
</h2>
<div class="section level5">
<h5 id="step-1-update-hatw_i-for-all-origins-using-formula">Step 1: Update <span class="math inline">\(\hat{w}_i\)</span> for
all origins using formula:<a class="anchor" aria-label="anchor" href="#step-1-update-hatw_i-for-all-origins-using-formula"></a>
</h5>
<p><span class="math display">\[\widehat{w}_{i}
=\left[Y_{i}^{-1}\sum_{j}\frac{\pi_{ij}\cdot e^{\beta\times
FTA_{ij}}}{\widehat{P}_{j}^{-\theta}}\cdot
E_{j}^{\prime}\right]^{\frac{1}{1+\theta}}\quad\forall i.\]</span></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eqn_base</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">Pi</span> <span class="op">*</span> <span class="va">B</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">E</span> <span class="op">/</span> <span class="va">P_hat</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">Y</span></span>
<span><span class="va">w_hat</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">w_hat</span>, <span class="va">eqn_base</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="step-2-normalize-so-total-world-output-stays-the-same">Step 2: Normalize so total world output stays the same:<a class="anchor" aria-label="anchor" href="#step-2-normalize-so-total-world-output-stays-the-same"></a>
</h5>
<p><span class="math inline">\(\sum_{i}Y_{i}\widehat{w}_{i}=\sum_{i}Y_{i}\)</span>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">w_hat</span>, <span class="va">w_hat</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span><span class="op">*</span><span class="va">w_hat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="step-3-update">Step 3: Update<a class="anchor" aria-label="anchor" href="#step-3-update"></a>
</h5>
<p><span class="math inline">\(\widehat{P}_{j}^{-\theta}=\left[\sum_{k}\pi_{kj}\widehat{w}_{k}^{-\theta}e^{b\times
FTA_{kj}}\right] \forall \ j\)</span>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">P_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">P_hat</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Pi</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">w_hat</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="step-4-update">Step 4: Update<a class="anchor" aria-label="anchor" href="#step-4-update"></a>
</h5>
<p><span class="math inline">\(E_{j}^{\prime}=Y_{j}\widehat{w}_{j}+D_{j}
\ \forall \ j\)</span>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">mult</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">E</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">E</span>, <span class="op">(</span><span class="va">Y</span> <span class="op">+</span> <span class="va">D</span><span class="op">)</span> <span class="op">*</span> <span class="va">w_hat</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># default is to have additive trade imbalances</span></span>
<span>  <span class="va">E</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">E</span>, <span class="va">Y</span> <span class="op">*</span> <span class="va">w_hat</span> <span class="op">+</span> <span class="va">D</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="calculate-new-trade-shares-to-verify-convergence">Calculate new trade shares (to verify convergence)<a class="anchor" aria-label="anchor" href="#calculate-new-trade-shares-to-verify-convergence"></a>
</h5>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Pi</span> <span class="op">*</span> <span class="va">B</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="op">(</span><span class="va">w_hat</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">P_hat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Pi_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">Pi</span>, <span class="va">p1</span> <span class="op">*</span> <span class="va">p2</span> <span class="op">/</span> <span class="va">p3</span>, <span class="fl">296</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Pi_new</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>From there, we just need a way to check convergence to a
steady-state, so let’s put it all together:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize w_i_hat = P_j_hat = 1</span></span>
<span><span class="va">w_hat</span> <span class="op">&lt;-</span> <span class="va">P_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, <span class="fl">1</span><span class="op">)</span>    <span class="co"># Wi = Ei/Pi</span></span>
<span></span>
<span><span class="co"># While Loop Initializations</span></span>
<span><span class="va">X_new</span>     <span class="op">&lt;-</span> <span class="va">X</span>         <span class="co"># Container for updated X</span></span>
<span><span class="va">crit</span>      <span class="op">&lt;-</span> <span class="fl">1</span>         <span class="co"># Convergence testing value</span></span>
<span><span class="va">curr_iter</span> <span class="op">&lt;-</span> <span class="fl">0</span>         <span class="co"># Current number of iterations</span></span>
<span><span class="va">max_iter</span>  <span class="op">&lt;-</span> <span class="fl">1000000</span>   <span class="co"># Maximum number of iterations</span></span>
<span><span class="va">tol</span>       <span class="op">&lt;-</span> <span class="fl">.00000001</span> <span class="co"># Threshold before sufficient convergence</span></span>
<span></span>
<span><span class="co"># B = i x j</span></span>
<span><span class="co"># D = 1 x j</span></span>
<span><span class="co"># E = 1 x j</span></span>
<span><span class="co"># w_hat = P_hat = i x 1</span></span>
<span><span class="co"># Y = E = D = i x 1</span></span>
<span></span>
<span><span class="kw">repeat</span> <span class="op">{</span> <span class="co"># Event Loop (using repeat to simulate do-while)</span></span>
<span></span>
<span>  <span class="va">X_last_step</span> <span class="op">&lt;-</span> <span class="va">X_new</span></span>
<span></span>
<span>  <span class="co">#### Step 1: Update w_hat_i for all origins:</span></span>
<span>  <span class="va">eqn_base</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">Pi</span> <span class="op">*</span> <span class="va">B</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">E</span> <span class="op">/</span> <span class="va">P_hat</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">Y</span></span>
<span>  <span class="va">w_hat</span>    <span class="op">&lt;-</span> <span class="va">eqn_base</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#### Step 2: Normalize so total world output stays the same</span></span>
<span>  <span class="va">w_hat</span> <span class="op">&lt;-</span> <span class="va">w_hat</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span><span class="op">*</span><span class="va">w_hat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#### Step 3: update P_hat_j</span></span>
<span>  <span class="va">P_hat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Pi</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">w_hat</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#### Step 4: Update $E_j$</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">mult</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">E</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Y</span> <span class="op">+</span> <span class="va">D</span><span class="op">)</span> <span class="op">*</span> <span class="va">w_hat</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">E</span> <span class="op">&lt;-</span> <span class="va">Y</span> <span class="op">*</span> <span class="va">w_hat</span> <span class="op">+</span> <span class="va">D</span>  <span class="co"># default is to have additive trade imbalances</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co">#### Calculate new trade shares (to verify convergence)</span></span>
<span>  <span class="va">p1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Pi</span> <span class="op">*</span> <span class="va">B</span><span class="op">)</span></span>
<span>  <span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="op">(</span><span class="va">w_hat</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">P_hat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Pi_new</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">*</span> <span class="va">p2</span> <span class="op">/</span> <span class="va">p3</span></span>
<span></span>
<span>  <span class="va">X_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Pi_new</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Compute difference to see if data converged</span></span>
<span>  <span class="va">crit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">X_new</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">X_last_step</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">curr_iter</span> <span class="op">&lt;-</span> <span class="va">curr_iter</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">crit</span> <span class="op">&lt;=</span> <span class="va">tol</span> <span class="op">||</span> <span class="va">curr_iter</span> <span class="op">&gt;=</span> <span class="va">max_iter</span><span class="op">)</span></span>
<span>    <span class="kw">break</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>From here, we can just aggregate statistics, based in part with the
formulas:</p>
<p><span class="math display">\[
\begin{alignat}{1}
\textbf{GE Welfare Impact}:\quad &amp;
\widehat{W}_{i}=\widehat{E}_{i}/\widehat{P}_{i}\\ \\
\textbf{GE Real Wage Impact}:\quad &amp;
\widehat{rw}_{ij}=\widehat{w}_{i}/\widehat{P}_{i},\\
\textbf{GE Trade Impact}:\quad &amp;
\widehat{X}_{ij}=\frac{\widehat{w}_{i}^{-\theta}e^{\beta\times
FTA_{ij}}}{\widehat{P}_{j}^{-\theta}}\cdot\widehat{E}_{j}
\end{alignat}
\]</span></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Post welfare effects and new trade values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X_new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">n</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Real wage impact</span></span>
<span><span class="va">real_wage</span>  <span class="op">&lt;-</span> <span class="va">w_hat</span> <span class="op">/</span> <span class="op">(</span><span class="va">P_hat</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">theta</span><span class="op">)</span></span>
<span><span class="co"># real_wage &lt;- (diag(Pi_new) / diag(Pi))^(-1/theta)  # (ACR formula)</span></span>
<span></span>
<span><span class="co"># Welfare impact</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">mult</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">welfare</span> <span class="op">&lt;-</span> <span class="va">real_wage</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">welfare</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">Y</span> <span class="op">*</span> <span class="va">w_hat</span><span class="op">)</span> <span class="op">+</span> <span class="va">D</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">Y</span><span class="op">+</span><span class="va">D</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">P_hat</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Kronecker w/ this creates n dupes per dataset in column to align with X matrix</span></span>
<span><span class="va">kron_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">welfare</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="va">welfare</span>, <span class="va">kron_base</span><span class="op">)</span></span>
<span><span class="va">real_wage</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="va">real_wage</span>, <span class="va">kron_base</span><span class="op">)</span></span>
<span><span class="va">nom_wage</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="va">w_hat</span>, <span class="va">kron_base</span><span class="op">)</span></span>
<span></span>
<span><span class="va">price_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">P_hat</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>, <span class="va">kron_base</span><span class="op">)</span></span></code></pre></div>
<p>And then, we can just return them:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build and return the final list</span></span>
<span><span class="va">data_out</span> <span class="op">&lt;-</span> <span class="va">ge_baseline_data</span></span>
<span></span>
<span><span class="va">data_out</span><span class="op">$</span><span class="va">new_trade</span>   <span class="op">&lt;-</span> <span class="va">X_new</span></span>
<span><span class="va">data_out</span><span class="op">$</span><span class="va">welfare</span>     <span class="op">&lt;-</span> <span class="va">welfare</span></span>
<span><span class="va">data_out</span><span class="op">$</span><span class="va">real_wage</span>   <span class="op">&lt;-</span> <span class="va">real_wage</span></span>
<span><span class="va">data_out</span><span class="op">$</span><span class="va">nom_wage</span>    <span class="op">&lt;-</span> <span class="va">nom_wage</span></span>
<span><span class="va">data_out</span><span class="op">$</span><span class="va">price_index</span> <span class="op">&lt;-</span> <span class="va">price_index</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_out</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">12</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    exporter importer year        trade    new_trade   welfare real_wage</span></span>
<span><span class="co">#&gt; 1       AUS      AUS 2000 704777.47410 7.047388e+05 0.9999938 0.9999945</span></span>
<span><span class="co">#&gt; 5       AUS      AUT 2000     61.95446 6.200899e+01 0.9999938 0.9999945</span></span>
<span><span class="co">#&gt; 9       AUS      BEL 2000    345.46746 3.454304e+02 0.9999938 0.9999945</span></span>
<span><span class="co">#&gt; 13      AUS      BGR 2000      5.71090 5.302484e+00 0.9999938 0.9999945</span></span>
<span><span class="co">#&gt; 17      AUS      BRA 2000    557.74257 5.576790e+02 0.9999938 0.9999945</span></span>
<span><span class="co">#&gt; 21      AUS      CAN 2000   1583.67895 1.583680e+03 0.9999938 0.9999945</span></span>
<span><span class="co">#&gt;     nom_wage price_index</span></span>
<span><span class="co">#&gt; 1  0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 5  0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 9  0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 13 0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 17 0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 21 0.9999236   0.9999292</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="running-the-algorithm">Running The Algorithm<a class="anchor" aria-label="anchor" href="#running-the-algorithm"></a>
</h2>
<div class="section level5">
<h5 id="pre-processing">Pre-Processing<a class="anchor" aria-label="anchor" href="#pre-processing"></a>
</h5>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Foreign trade subset</span></span>
<span><span class="va">f_trade</span> <span class="op">&lt;-</span> <span class="va">TradeData0014</span><span class="op">[</span><span class="va">TradeData0014</span><span class="op">$</span><span class="va">exporter</span> <span class="op">!=</span> <span class="va">TradeData0014</span><span class="op">$</span><span class="va">importer</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Normalize trade data to unit interval</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">trade</span> <span class="op">&lt;-</span> <span class="va">f_trade</span><span class="op">$</span><span class="va">trade</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">trade</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># classify FEs for components to be absorbed (finding variable interactions)</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">exp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">imp_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">f_trade</span><span class="op">$</span><span class="va">pair</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">f_trade</span><span class="op">$</span><span class="va">impcode</span>, <span class="va">f_trade</span><span class="op">$</span><span class="va">expcode</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit generalized linear model based on specifications</span></span>
<span><span class="va">partials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/alpaca/man/feglm.html" class="external-link">feglm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">trade</span> <span class="op">~</span> <span class="va">eu_enlargement</span> <span class="op">+</span> <span class="va">other_fta</span> <span class="op">|</span> <span class="va">exp_year</span> <span class="op">+</span> <span class="va">imp_year</span> <span class="op">+</span> <span class="va">pair</span>,</span>
<span>  data    <span class="op">=</span> <span class="va">f_trade</span>,</span>
<span>  family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">coefficient</span>  <span class="co"># We just need the coefficients for computation</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sort trade matrix to make it easier to find imp/exp pairs</span></span>
<span><span class="va">t_trade</span> <span class="op">&lt;-</span> <span class="va">TradeData0014</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span></span>
<span>  <span class="va">TradeData0014</span><span class="op">$</span><span class="va">exporter</span>,</span>
<span>  <span class="va">TradeData0014</span><span class="op">$</span><span class="va">importer</span>,</span>
<span>  <span class="va">TradeData0014</span><span class="op">$</span><span class="va">year</span></span>
<span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">t_trade</span><span class="op">$</span><span class="va">eu_effect</span> <span class="op">&lt;-</span> <span class="cn">NA</span>      <span class="co"># this creates a new column with the partial effect of EU membership for new EU pairs</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Effect of EU entrance on country based on partial, if entry happened</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">t_trade</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">t_trade</span><span class="op">$</span><span class="va">expcode</span>, <span class="va">t_trade</span><span class="op">$</span><span class="va">impcode</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Was a new EU pair created within time span?</span></span>
<span>  <span class="va">t_trade</span><span class="op">[</span><span class="va">i</span><span class="op">:</span><span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="st">"eu_effect"</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">row</span><span class="op">$</span><span class="va">eu_enlargement</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># If added to EU, give it the computed partial eu_enlargement coefficient as the effect</span></span>
<span><span class="va">t_trade</span><span class="op">$</span><span class="va">eu_effect</span> <span class="op">=</span> <span class="va">t_trade</span><span class="op">$</span><span class="va">eu_effect</span> <span class="op">*</span> <span class="va">partials</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Data to be finally fed to the function</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">t_trade</span><span class="op">[</span><span class="va">t_trade</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2000</span>,<span class="op">]</span>   <span class="co"># In example, 1892 Entries, 5676 removed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    exporter importer expcode impcode year        trade eu_enlargement other_fta</span></span>
<span><span class="co">#&gt; 1       AUS      AUS       1       1 2000 704777.47410              0         1</span></span>
<span><span class="co">#&gt; 5       AUS      AUT       1       2 2000     61.95446              0         0</span></span>
<span><span class="co">#&gt; 9       AUS      BEL       1       3 2000    345.46746              0         0</span></span>
<span><span class="co">#&gt; 13      AUS      BGR       1       4 2000      5.71090              0         0</span></span>
<span><span class="co">#&gt; 17      AUS      BRA       1       5 2000    557.74257              0         0</span></span>
<span><span class="co">#&gt; 21      AUS      CAN       1       6 2000   1583.67895              0         0</span></span>
<span><span class="co">#&gt;    FTA pair eu_effect</span></span>
<span><span class="co">#&gt; 1    1  1.1         0</span></span>
<span><span class="co">#&gt; 5    0  1.2         0</span></span>
<span><span class="co">#&gt; 9    0  1.3         0</span></span>
<span><span class="co">#&gt; 13   0  1.4         0</span></span>
<span><span class="co">#&gt; 17   0  1.5         0</span></span>
<span><span class="co">#&gt; 21   0  1.6         0</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="running-actual-computations">Running Actual Computations<a class="anchor" aria-label="anchor" href="#running-actual-computations"></a>
</h5>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Difference between w_mult and w_o_mult is how trade balance is considered</span></span>
<span><span class="co">## mult = TRUE assumes multiplicative trade balances; false assumes additive</span></span>
<span></span>
<span><span class="va">w_mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ge_gravity.html">ge_gravity</a></span><span class="op">(</span></span>
<span>  exp_id <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">expcode</span>,    <span class="co"># Origin country associated with each observation</span></span>
<span>  imp_id <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">impcode</span>,    <span class="co"># Destination country associated with each observation</span></span>
<span>  flows  <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">trade</span>,      <span class="co"># Observed trade flows in the data for the year being used as the baseline</span></span>
<span>  beta   <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">eu_effect</span>,  <span class="co"># “Partial” change in trade, obtained as coefficient from gravity estimation</span></span>
<span>  theta  <span class="op">=</span> <span class="fl">4</span>,               <span class="co"># Trade elasticity</span></span>
<span>  mult   <span class="op">=</span> <span class="cn">TRUE</span>,            <span class="co"># Assume trade balance is a multiplicative component of national expenditure</span></span>
<span>  data   <span class="op">=</span> <span class="va">data</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">w_o_mult</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/ge_gravity.html">ge_gravity</a></span><span class="op">(</span></span>
<span>  exp_id <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">expcode</span>,    <span class="co"># Origin country associated with each observation</span></span>
<span>  imp_id <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">impcode</span>,    <span class="co"># Destination country associated with each observation</span></span>
<span>  flows  <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">trade</span>,      <span class="co"># Observed trade flows in the data for the year being used as the baseline</span></span>
<span>  beta   <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">eu_effect</span>,  <span class="co"># “Partial” change in trade, obtained as coefficient from gravity estimation</span></span>
<span>  theta  <span class="op">=</span> <span class="fl">4</span>,                <span class="co"># Trade elasticity</span></span>
<span>  mult   <span class="op">=</span> <span class="cn">FALSE</span>,           <span class="co"># Assume trade balance is an additive component of national expenditure</span></span>
<span>  data   <span class="op">=</span> <span class="va">data</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="final-results-without-multiplication-parameter">Final results without multiplication parameter<a class="anchor" aria-label="anchor" href="#final-results-without-multiplication-parameter"></a>
</h5>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">w_o_mult</span><span class="op">)</span></span>
<span><span class="co">#&gt;    exporter importer expcode impcode year        trade eu_enlargement other_fta</span></span>
<span><span class="co">#&gt; 1       AUS      AUS       1       1 2000 704777.47410              0         1</span></span>
<span><span class="co">#&gt; 5       AUS      AUT       1       2 2000     61.95446              0         0</span></span>
<span><span class="co">#&gt; 9       AUS      BEL       1       3 2000    345.46746              0         0</span></span>
<span><span class="co">#&gt; 13      AUS      BGR       1       4 2000      5.71090              0         0</span></span>
<span><span class="co">#&gt; 17      AUS      BRA       1       5 2000    557.74257              0         0</span></span>
<span><span class="co">#&gt; 21      AUS      CAN       1       6 2000   1583.67895              0         0</span></span>
<span><span class="co">#&gt;    FTA pair eu_effect    new_trade   welfare real_wage  nom_wage price_index</span></span>
<span><span class="co">#&gt; 1    1  1.1         0 7.047388e+05 0.9999938 0.9999945 0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 5    0  1.2         0 6.200899e+01 0.9999938 0.9999945 0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 9    0  1.3         0 3.454304e+02 0.9999938 0.9999945 0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 13   0  1.4         0 5.302484e+00 0.9999938 0.9999945 0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 17   0  1.5         0 5.576790e+02 0.9999938 0.9999945 0.9999236   0.9999292</span></span>
<span><span class="co">#&gt; 21   0  1.6         0 1.583680e+03 0.9999938 0.9999945 0.9999236   0.9999292</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="final-results-with-multiplication-parameter">Final results with multiplication parameter<a class="anchor" aria-label="anchor" href="#final-results-with-multiplication-parameter"></a>
</h5>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">w_mult</span><span class="op">)</span></span>
<span><span class="co">#&gt;    exporter importer expcode impcode year        trade eu_enlargement other_fta</span></span>
<span><span class="co">#&gt; 1       AUS      AUS       1       1 2000 704777.47410              0         1</span></span>
<span><span class="co">#&gt; 5       AUS      AUT       1       2 2000     61.95446              0         0</span></span>
<span><span class="co">#&gt; 9       AUS      BEL       1       3 2000    345.46746              0         0</span></span>
<span><span class="co">#&gt; 13      AUS      BGR       1       4 2000      5.71090              0         0</span></span>
<span><span class="co">#&gt; 17      AUS      BRA       1       5 2000    557.74257              0         0</span></span>
<span><span class="co">#&gt; 21      AUS      CAN       1       6 2000   1583.67895              0         0</span></span>
<span><span class="co">#&gt;    FTA pair eu_effect    new_trade   welfare real_wage  nom_wage price_index</span></span>
<span><span class="co">#&gt; 1    1  1.1         0 7.047407e+05 0.9999948 0.9999948 0.9999268   0.9999321</span></span>
<span><span class="co">#&gt; 5    0  1.2         0 6.200460e+01 0.9999948 0.9999948 0.9999268   0.9999321</span></span>
<span><span class="co">#&gt; 9    0  1.3         0 3.454142e+02 0.9999948 0.9999948 0.9999268   0.9999321</span></span>
<span><span class="co">#&gt; 13   0  1.4         0 5.261708e+00 0.9999948 0.9999948 0.9999268   0.9999321</span></span>
<span><span class="co">#&gt; 17   0  1.5         0 5.576743e+02 0.9999948 0.9999948 0.9999268   0.9999321</span></span>
<span><span class="co">#&gt; 21   0  1.6         0 1.583683e+03 0.9999948 0.9999948 0.9999268   0.9999321</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="comparison-with-stata-counterpart">Comparison with Stata Counterpart<a class="anchor" aria-label="anchor" href="#comparison-with-stata-counterpart"></a>
</h2>
<p>Before running comparisons, we need to slightly modify the results
data to sync with our new format.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Notice that the Stata counterpart returned all years with a sparse</span></span>
<span><span class="co"># selection labeled with computed values. Ours just returns the new data</span></span>
<span><span class="co"># by default or tags it onto the data provided in the `data` parameter.</span></span>
<span></span>
<span><span class="co"># To make it sync, just extract a year.</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">TradeData0014_Results</span><span class="op">[</span><span class="va">TradeData0014_Results</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2000</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt;    exporter importer expcode impcode year        trade eu_enlargement other_fta</span></span>
<span><span class="co">#&gt; 1       AUS      AUS       1       1 2000 704777.47410              0         1</span></span>
<span><span class="co">#&gt; 5       AUS      AUT       1       2 2000     61.95446              0         0</span></span>
<span><span class="co">#&gt; 9       AUS      BEL       1       3 2000    345.46746              0         0</span></span>
<span><span class="co">#&gt; 13      AUS      BGR       1       4 2000      5.71090              0         0</span></span>
<span><span class="co">#&gt; 17      AUS      BRA       1       5 2000    557.74257              0         0</span></span>
<span><span class="co">#&gt; 21      AUS      CAN       1       6 2000   1583.67895              0         0</span></span>
<span><span class="co">#&gt;    FTA new_eu_pair eu_effect      w_eu         X_eu    w_mult       X_mult</span></span>
<span><span class="co">#&gt; 1    1           0         0 0.9999938 7.047388e+05 0.9999948 7.047407e+05</span></span>
<span><span class="co">#&gt; 5    0           0         0 0.9999938 6.200899e+01 0.9999948 6.200460e+01</span></span>
<span><span class="co">#&gt; 9    0           0         0 0.9999938 3.454304e+02 0.9999948 3.454142e+02</span></span>
<span><span class="co">#&gt; 13   0           0         0 0.9999938 5.302484e+00 0.9999948 5.261708e+00</span></span>
<span><span class="co">#&gt; 17   0           0         0 0.9999938 5.576790e+02 0.9999948 5.576743e+02</span></span>
<span><span class="co">#&gt; 21   0           0         0 0.9999938 1.583680e+03 0.9999948 1.583683e+03</span></span></code></pre></div>
<div class="section level5">
<h5 id="comparison-of-w_eu-from-results-to-the-welfare-wo-multiplier">Comparison of w_eu from results to the welfare w/o multiplier<a class="anchor" aria-label="anchor" href="#comparison-of-w_eu-from-results-to-the-welfare-wo-multiplier"></a>
</h5>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">w_eu</span>, y <span class="op">=</span> <span class="va">w_o_mult</span><span class="op">$</span><span class="va">welfare</span>, log <span class="op">=</span> <span class="st">"xy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="about_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Max difference: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">w_eu</span> <span class="op">-</span> <span class="va">w_o_mult</span><span class="op">$</span><span class="va">welfare</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Max difference: 5.84207948683968e-08</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="comparison-of-w_mult-from-results-to-the-welfare-with-multiplier">Comparison of w_mult from results to the welfare with
multiplier<a class="anchor" aria-label="anchor" href="#comparison-of-w_mult-from-results-to-the-welfare-with-multiplier"></a>
</h5>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">w_mult</span>, y <span class="op">=</span> <span class="va">w_mult</span><span class="op">$</span><span class="va">welfare</span>, log <span class="op">=</span> <span class="st">"xy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="about_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Max difference: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">w_mult</span> <span class="op">-</span> <span class="va">w_mult</span><span class="op">$</span><span class="va">welfare</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Max difference: 5.82429970918952e-08</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="comparing-results-of-new-x-wo-multiplier-option">Comparing results of new X w/o multiplier option<a class="anchor" aria-label="anchor" href="#comparing-results-of-new-x-wo-multiplier-option"></a>
</h5>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">X_eu</span>, y <span class="op">=</span> <span class="va">w_o_mult</span><span class="op">$</span><span class="va">new_trade</span>, log <span class="op">=</span> <span class="st">"xy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="about_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Max difference: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">X_eu</span> <span class="op">-</span> <span class="va">w_o_mult</span><span class="op">$</span><span class="va">new_trade</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Max difference: 0.217820517718792</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="comparing-results-of-new-x-with-multiplier-option">Comparing results of new X with multiplier option<a class="anchor" aria-label="anchor" href="#comparing-results-of-new-x-with-multiplier-option"></a>
</h5>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">X_mult</span>, y <span class="op">=</span> <span class="va">w_mult</span><span class="op">$</span><span class="va">new_trade</span>, log <span class="op">=</span> <span class="st">"xy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="about_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Max difference: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">X_mult</span> <span class="op">-</span> <span class="va">w_mult</span><span class="op">$</span><span class="va">new_trade</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Max difference: 0.472535479813814</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="advisory">Advisory<a class="anchor" aria-label="anchor" href="#advisory"></a>
</h2>
<p>This is an advanced technique that requires a basic understanding of
the model being solved. I would recommend reading either Section 4.3 of
Head &amp; Mayer (2014) or Ch. 2 of Yotov, Piermartini, Monteiro, &amp;
Larch (2016) before implementing.</p>
<p>One common issue that researchers new to these methods should be
aware of is that GE trade models require a “square” data set with
information on internal trade flows in addition to data on international
trade flows. In the model, these internal flows are denoted by <span class="math inline">\(X_{ii}\)</span>. If <code>ge_gravity</code>
detects that the variable given for does not include one or more <span class="math inline">\(X_{ii}\)</span> terms, it will exit with an error.
Not all publicly available trade data sets include internal trade
values. But some that do include <a href="http://www.wiod.org/home" class="external-link">WIOD</a>, <a href="https://worldmrio.com/" class="external-link">Eora MRIO</a>, and the data set made
available by <a href="https://vi.unctad.org/tpa/index.html" class="external-link">UNCTAD</a>
as part of their online course on trade policy analysis (see Yotov,
Piermartini, Monteiro, &amp; Larch, 2016.)</p>
<p>Depending on interest, future versions could feature additional
options such as allowances for tariff revenues and/or multiple sectors.
If you believe you have found an error that can be replicated, or have
other suggestions for improvements, please feel free to<br><a href="mailto:tomzylkin@gmail.com">contact me</a>.</p>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>The basic idea of using fixed point iteration to solve the gravity
model has previously been implemented in Stata by Head &amp; Mayer
(2014) and Anderson, Larch, &amp; Yotov (2015). Funding for this R
package was provided by the Department for Digital, Culture, Media and
Sport, United Kingdom.</p>
</div>
<div class="section level2">
<h2 id="suggested-citation">Suggested citation<a class="anchor" aria-label="anchor" href="#suggested-citation"></a>
</h2>
<p>If you are using this command in your research, please cite</p>
<ul>
<li>Baier, Scott L., Yoto V. Yotov, and Thomas Zylkin. “On the widely
differing effects of free trade agreements: Lessons from twenty years of
trade integration”. Journal of International Economics 116 (2019):
206-226.</li>
</ul>
<p>The algorithm used in this command was specifically written for the
exercises performed in this paper. Section 6 of the paper provides a
more detailed description of the underlying model and its connection to
the literature.</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ul>
<li>Structural gravity: Anderson &amp; van Wincoop (2003); Head &amp;
Mayer (2014)</li>
<li>Methods for solving trade models: Alvarez &amp; Lucas (2007);
Anderson, Larch, &amp; Yotov (2015); Head &amp; Mayer (2014)</li>
<li>Hat algebra: Dekle, Eaton, &amp; Kortum (2007)</li>
<li>GE effects of EU enlargements: Felbermayr, Gröschl, &amp; Heiland
(2018); Mayer, Vicard, &amp; Zignago (2018).</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p><a href="https://www.sciencedirect.com/science/article/abs/pii/S0304393206002169" class="external-link">Alvarez,
F. &amp; Lucas, J., Robert E. (2007), “General equilibrium analysis of
the Eaton–Kortum model of international trade”, Journal of Monetary
Economics 54(6), 1726–1768.</a></p>
<p><a href="https://ideas.repec.org/p/ces/ceswps/_5592.html" class="external-link">Anderson,
J. E., Larch, M., &amp; Yotov, Y. V. (2015), “Estimating General
Equilibrium Trade Policy Effects: GE PPML”, CESifo Working Paper
5592.</a></p>
<p><a href="https://www.jstor.org/stable/3132167?seq=1" class="external-link">Anderson, J. E.
&amp; van Wincoop, E. (2003), “Gravity with Gravitas: A Solution to the
Border Puzzle”, American Economic Review 93(1), 170–192.</a></p>
<p><a href="https://www.sciencedirect.com/science/article/abs/pii/S0022199615001531" class="external-link">Anderson,
J. E. &amp; Yotov, Y. V. (2016), “Terms of trade and global efficiency
effects of free trade agreements, 1990–2002”, Journal of International
Economics 99, 279–298.</a></p>
<p><a href="https://www.sciencedirect.com/science/article/abs/pii/S0022199618304367" class="external-link">Baier,
S. L., Yotov, Y. V., &amp; Zylkin, T. (2019), “On the widely differing
effects of free trade agreements: Lessons from twenty years of trade
integration”, Journal of International Economics 116, 206–226.</a></p>
<p><a href="https://ideas.repec.org/p/arx/papers/1903.01690.html" class="external-link">Correia, S.,
Guimarães, P., &amp; Zylkin, T. (2019), “ppmlhdfe: Fast Poisson
Estimation with High-Dimensional Data”, arXiv preprint
arXiv:1903.01690.</a></p>
<p><a href="https://www.researchgate.net/publication/4981229_Unbalanced_Trade" class="external-link">Dekle,
R., Eaton, J., &amp; Kortum, S. (2007), “Unbalanced Trade”, American
Economic Review 97(2), 351–355. Egger, P., Larch, M., Staub, K. E.,
&amp; Winkelmann, R. (2011), “The Trade Effects of Endogenous
Preferential</a></p>
<p><a href="https://www.jstor.org/stable/41238105?seq=1" class="external-link">Egger, P.,
Larch, M., Staub, K. E., &amp; Winkelmann, R. (2011), “The Trade Effects
of Endogenous Preferential Trade Agreements”, American Economic Journal:
Economic Policy 3(3), 113–143.</a></p>
<p><a href="https://ideas.repec.org/p/ces/ifowps/_250.html" class="external-link">Felbermayr,
G., Gröschl, J. K., &amp; Heiland, I. (2018), “Undoing Europe in a new
quantitative trade model”, Tech. rep., Ifo Working Paper.</a></p>
<p><a href="http://www.cepii.fr/pdf_pub/wp/2013/wp2013-27.pdf" class="external-link">Head, K.
&amp; Mayer, T. (2014), “Gravity Equations: Workhorse, Toolkit, and
Cookbook”, in G. Gopinath, E. Help- man, &amp; K. Rogoff (eds.) Handbook
of International Economics, vol. 4, pp. 131–195, North Holland, 4
ed.</a></p>
<p><a href="http://www.cepii.fr/PDF_PUB/wp/2018/wp2018-06.pdf" class="external-link">Mayer,
T., Vicard, V., &amp; Zignago, S. (2018), “The cost of non-Europe,
revisited”.</a></p>
<p><a href="https://onlinelibrary.wiley.com/doi/full/10.1111/roie.12178?casa_token=_JZInGh_hO8AAAAA%3A71VfkDsx8FK4h8FH30U9iPH6FnXDmem0FrzmuSVnAfOaZ6RpqcVfiml_apbzCpOJTgpjxcO2Cw-2WLo" class="external-link">Timmer,
M.P., Dietzenbacher, E., Los, B., Stehrer, R. and De Vries, G.J. (2015),
“An illustrated user guide to the world input–output database: the case
of global automotive production”. Review of International Economics,
23(3), pp.575-605.</a></p>
<p><a href="https://www.wto.org/english/res_e/booksp_e/advancedwtounctad2016_e.pdf" class="external-link">Yotov,
Y. V., Piermartini, R., Monteiro, J.-A., &amp; Larch, M. (2016), An
Advanced Guide to Trade Policy Analysis: The Structural Gravity Model,
World Trade Organization, Geneva.</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tom Zylkin, Vadim Kudlay.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
